---
milestone: v4.0
audited: 2026-02-20
status: gaps_found
scores:
  requirements: 14/20
  phases: 0/4 verified
  integration: 17/20 wired
  flows: 6/8 complete
gaps:
  requirements:
    - id: "PORT-01"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-01-PLAN.md", "26-03-PLAN.md"]
      completed_by_plans: ["26-01-SUMMARY.md", "26-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Domain model and EF persistence exist, but no POST /api/portfolio/assets endpoint. Users cannot create portfolio assets from the Flutter app — assets must be manually seeded in the database."
    - id: "PORT-03"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-01-PLAN.md"]
      completed_by_plans: ["26-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Domain model exists but Flutter sends 'None' for CompoundingFrequency while backend enum is 'Simple'. POST /api/portfolio/fixed-deposits returns 400 for simple-interest deposits."
    - id: "PORT-04"
      status: "partial"
      phase: "Phase 28"
      claimed_by_plans: ["28-01-PLAN.md"]
      completed_by_plans: ["28-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Code wired (PortfolioPurchaseCompletedEventHandler, unique filtered index on SourcePurchaseId). No VERIFICATION.md exists. Integration checker confirms wiring."
    - id: "PORT-05"
      status: "partial"
      phase: "Phase 28"
      claimed_by_plans: ["28-01-PLAN.md"]
      completed_by_plans: ["28-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Code wired (HistoricalPurchaseMigrator triggered from GetSummaryAsync). No VERIFICATION.md exists. Integration checker confirms wiring."
    - id: "PRICE-01"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-01-PLAN.md"]
      completed_by_plans: ["27-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "CoinGeckoPriceProvider implemented with 5-min freshness/30-day TTL. Not listed in SUMMARY frontmatter requirements-completed. Integration checker confirms wiring."
    - id: "PRICE-02"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-02-PLAN.md"]
      completed_by_plans: ["27-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "VNDirectPriceProvider implemented with 48h TTL stale-while-revalidate. Not listed in SUMMARY frontmatter requirements-completed. Integration checker confirms wiring."
    - id: "PRICE-03"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-02-PLAN.md"]
      completed_by_plans: ["27-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "OpenErApiProvider implemented with 12h TTL. Not listed in SUMMARY frontmatter requirements-completed. Integration checker confirms wiring."
    - id: "PRICE-04"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-01-PLAN.md", "27-02-PLAN.md"]
      completed_by_plans: ["27-01-SUMMARY.md", "27-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "PriceFeedResult.IsStale + FetchedAt propagated through PortfolioAssetResponse to Flutter StalenessLabel. Not listed in SUMMARY frontmatter. Integration checker confirms wiring."
    - id: "DISP-03"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Donut chart renders with correct proportions. However, touch tooltip shows USD value formatted as VND when in VND mode. AllocationDto lacks valueVnd field."
    - id: "DISP-05"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-03-PLAN.md"]
      completed_by_plans: ["29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Add fixed deposit form exists but sends 'None' for CompoundingFrequency. Backend expects 'Simple'. 400 error on simple-interest deposits."
  integration:
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "CompoundingFrequency enum mismatch: Flutter sends 'None', backend expects 'Simple'. Affects PORT-03, DISP-05."
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "AllocationDto missing valueVnd field. Donut chart tooltip shows incorrect values in VND mode. Affects DISP-03."
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "No POST /api/portfolio/assets endpoint. No Flutter UI to create assets. Assets must be DB-seeded. Affects PORT-01."
  flows:
    - flow: "Fixed Deposit Creation"
      breaks_at: "Flutter form → POST /api/portfolio/fixed-deposits (enum mismatch → 400 error)"
    - flow: "Donut Chart VND Tooltip"
      breaks_at: "AllocationDonutChart._buildTooltip formats USD value with VND formatter in VND mode"
tech_debt:
  - phase: 26-portfolio-domain-foundation
    items: []
  - phase: 27-price-feed-infrastructure
    items:
      - "VNDirect dchart-api is undocumented/unofficial — could change without notice (research valid until 2026-03-20)"
      - "SUMMARY.md frontmatter missing requirements-completed for PRICE-01, PRICE-02, PRICE-03, PRICE-04"
  - phase: 28-portfolio-backend-api
    items:
      - "SUMMARY.md frontmatter missing requirements-completed for PORT-04, PORT-05"
      - "PUT/DELETE /api/portfolio/fixed-deposits/{id} endpoints exist but have no Flutter UI (orphaned from mobile layer)"
      - "Exchange rate failure defaults to 0 (VND values show as 0 when rate unavailable)"
  - phase: 29-flutter-portfolio-ui
    items:
      - "PortfolioRepository does not expose updateFixedDeposit or deleteFixedDeposit methods"
      - "FixedDepositDetailScreen is read-only with no edit/delete actions"
  - all_phases:
    items:
      - "No VERIFICATION.md exists for any of the 4 phases — all phases are formally unverified"
      - "REQUIREMENTS.md traceability table still shows all 20 requirements as [ ] Pending"
---

# v4.0 Portfolio Tracker — Milestone Audit

**Audited:** 2026-02-20
**Status:** gaps_found
**Phases:** 4 (26-29), all plans executed (10/10)
**Requirements:** 14/20 satisfied, 6 partial (verification gaps + bugs)

## Phase Verification Status

| Phase | Plans | VERIFICATION.md | Status |
|-------|-------|-----------------|--------|
| 26 - Portfolio Domain Foundation | 3/3 executed | Missing | Unverified |
| 27 - Price Feed Infrastructure | 2/2 executed | Missing | Unverified |
| 28 - Portfolio Backend API | 2/2 executed | Missing | Unverified |
| 29 - Flutter Portfolio UI | 3/3 executed | Missing | Unverified |

**All 4 phases are formally unverified** — no VERIFICATION.md files were created during execution.

## Requirements Cross-Reference (3-Source)

### Source Legend
- **V** = VERIFICATION.md status (all missing)
- **S** = SUMMARY.md frontmatter `requirements-completed`
- **R** = REQUIREMENTS.md traceability checkbox
- **I** = Integration checker assessment

| REQ-ID | V | S | R | I | Final Status | Notes |
|--------|---|---|---|---|--------------|-------|
| PORT-01 | - | listed | [ ] | PARTIAL | **partial** | No create asset endpoint; DB seeding required |
| PORT-02 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| PORT-03 | - | listed | [ ] | BROKEN | **partial** | Enum mismatch: Flutter 'None' vs backend 'Simple' |
| PORT-04 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| PORT-05 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| PORT-06 | - | listed | [ ] | WIRED | **partial** | Verification gap only — 8 unit tests pass |
| PRICE-01 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| PRICE-02 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| PRICE-03 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| PRICE-04 | - | - | [ ] | WIRED | **partial** | Missing from SUMMARY frontmatter; code wired |
| DISP-01 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-02 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-03 | - | listed | [ ] | PARTIAL | **partial** | Tooltip shows USD as VND in VND mode |
| DISP-04 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-05 | - | listed | [ ] | BROKEN | **partial** | Enum mismatch blocks simple-interest FD creation |
| DISP-06 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-07 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-08 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-09 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |
| DISP-10 | - | listed | [ ] | WIRED | **partial** | Verification gap only — code works |

### Gap Categories

**Critical — Code Bugs (3 requirements affected):**
1. **PORT-03 / DISP-05**: CompoundingFrequency enum mismatch — Flutter sends `'None'`, backend expects `'Simple'`. 400 error on fixed deposit creation.
2. **DISP-03**: AllocationDonutChart tooltip formats USD value with VND formatter in VND mode.
3. **PORT-01**: No `POST /api/portfolio/assets` endpoint. Assets must be manually seeded in DB.

**Documentation Gaps (all 20 requirements):**
- No VERIFICATION.md for any phase (all unverified)
- 6 requirements missing from SUMMARY frontmatter (PRICE-01..04, PORT-04, PORT-05)
- REQUIREMENTS.md traceability still shows all 20 as `[ ] Pending`

## Integration Checker Report

### Wiring Summary
- **Connected:** 17/20 requirement integration paths fully wired
- **Broken:** 2 flows (enum mismatch, tooltip bug)
- **Gap:** 1 flow (no asset creation endpoint)

### E2E Flows

| Flow | Status | Break Point |
|------|--------|-------------|
| View portfolio summary | Complete | - |
| Add manual transaction | Complete | - |
| Create fixed deposit (compound) | Complete | - |
| Create fixed deposit (simple) | **Broken** | Flutter sends 'None', backend rejects |
| View transaction history | Complete | - |
| View fixed deposit detail | Complete | - |
| DCA auto-import | Complete | - |
| Donut chart VND tooltip | **Broken** | Shows USD value with VND formatter |

### API Route Coverage

| Route | Backend | Flutter Repo | Flutter UI |
|-------|---------|-------------|------------|
| GET /api/portfolio/summary | Yes | Yes | Yes |
| GET /api/portfolio/assets | Yes | Yes | Yes |
| GET /api/portfolio/assets/{id}/transactions | Yes | Yes | Yes |
| POST /api/portfolio/assets/{id}/transactions | Yes | Yes | Yes |
| GET /api/portfolio/fixed-deposits | Yes | Yes | Yes |
| GET /api/portfolio/fixed-deposits/{id} | Yes | Yes | Yes |
| POST /api/portfolio/fixed-deposits | Yes | Yes | Yes (broken) |
| PUT /api/portfolio/fixed-deposits/{id} | Yes | No | No |
| DELETE /api/portfolio/fixed-deposits/{id} | Yes | No | No |

## Tech Debt

### Phase 27: Price Feed Infrastructure
- VNDirect dchart-api is undocumented/unofficial — could change without notice
- SUMMARY frontmatter missing `requirements-completed` for PRICE-01..04

### Phase 28: Portfolio Backend API
- SUMMARY frontmatter missing `requirements-completed` for PORT-04, PORT-05
- PUT/DELETE fixed deposit endpoints have no Flutter UI
- Exchange rate failure defaults to 0 (VND values show as 0)

### Phase 29: Flutter Portfolio UI
- PortfolioRepository lacks updateFixedDeposit/deleteFixedDeposit methods
- FixedDepositDetailScreen is read-only (no edit/delete)

### Cross-Phase
- No VERIFICATION.md for any phase (all formally unverified)
- REQUIREMENTS.md traceability shows all 20 as Pending

**Total tech debt items:** 10 across 4 phases

---
*Audit completed: 2026-02-20*
