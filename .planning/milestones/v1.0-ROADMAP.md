# Milestone v1.0: Daily BTC Smart DCA on Hyperliquid

**Status:** SHIPPED 2026-02-12
**Phases:** 1-4
**Total Plans:** 11

## Overview

Working BTC Smart DCA bot on Hyperliquid spot market. Daily automated purchases with smart multipliers based on price drops from 30-day high and 200-day moving average bear market detection. Rich Telegram notifications, health monitoring, and dry-run simulation mode.

## Phases

### Phase 1: Foundation & Hyperliquid Client

**Goal:** Working Hyperliquid API client that can fetch prices, get balances, and place spot orders on testnet. Domain models and persistence layer ready. Configuration system in place.

**Requirements:** FR-1, FR-2, FR-3, FR-10

**Plans:** 2 plans

- [x] 01-01-PLAN.md — Configuration, domain models, persistence, and distributed lock foundation
- [x] 01-02-PLAN.md — Hyperliquid API client with EIP-712 signing and testnet verification

**Success criteria:**
- [x] HyperliquidClient can authenticate and place a spot buy on testnet
- [x] Domain models (Purchase, DailyPrice) persisted via EF Core
- [x] Distributed lock uses real Redis/Dapr locking (not stub)
- [x] All DCA configuration loads from appsettings.json
- [x] Private key never appears in any log output

---

### Phase 2: Core DCA Engine

**Goal:** Bot buys a fixed USD amount of BTC daily on Hyperliquid, persists the result, and sends a Telegram confirmation. End-to-end working buy flow.

**Requirements:** FR-4, FR-5, FR-6

**Plans:** 3 plans

- [x] 02-01-PLAN.md — Domain events, Telegram notification service, and MediatR handlers
- [x] 02-02-PLAN.md — DCA execution service (core buy pipeline: lock, balance, order, persist, events)
- [x] 02-03-PLAN.md — DCA scheduler background service and Program.cs DI wiring

**Success criteria:**
- [x] DcaSchedulerBackgroundService triggers daily at configured time
- [x] Bot buys configured base amount of BTC on Hyperliquid spot
- [x] Purchase persisted with all metadata (price, qty, cost, status)
- [x] Telegram notification sent on success and failure
- [x] Idempotent: no duplicate purchases on same day
- [x] Handles partial fills correctly
- [x] Retries transient failures up to 3 times

---

### Phase 3: Smart Multipliers

**Goal:** Bot adjusts buy amount based on dip severity (30-day high tiers) and bear market conditions (200-day MA), buying more aggressively during dips and downtrends.

**Requirements:** FR-7, FR-8, FR-9

**Plans:** 3 plans

- [x] 03-01-PLAN.md — Data foundation: DailyPrice entity, candle API, Purchase metadata fields, DB migration
- [x] 03-02-PLAN.md — PriceDataService: bootstrap, daily refresh, 30-day high, 200-day SMA calculations
- [x] 03-03-PLAN.md — DCA integration: smart multiplier wiring, DI registration, graceful degradation

**Success criteria:**
- [x] 30-day high tracked from daily candle data
- [x] Dip tier multiplier correctly calculated (1x / 1.5x / 2x / 3x)
- [x] 200-day MA calculated from historical daily closes
- [x] Bear boost (1.5x) applied when price < 200-day MA
- [x] Multipliers stack correctly (e.g., 2x dip * 1.5x bear = 3x)
- [x] Each purchase records: multiplier, tier, 30d high, MA value, drop %
- [x] Stale data policy: use last known values (CONTEXT.md override)

---

### Phase 4: Enhanced Notifications & Observability

**Goal:** Rich Telegram messages explaining buy reasoning, running totals, health monitoring, and dry-run mode for testing.

**Requirements:** FR-11, FR-12, FR-13

**Plans:** 3 plans

- [x] 04-01-PLAN.md — Dry-run mode, IsDryRun flag, enhanced PurchaseCompletedEvent with multiplier metadata, EF Core migration
- [x] 04-02-PLAN.md — Rich notification handlers: multiplier reasoning, running totals, SIMULATION banner
- [x] 04-03-PLAN.md — Weekly summary service, missed purchase verification, DCA health check, Program.cs wiring

**Success criteria:**
- [x] Telegram buy messages include: multiplier reasoning, 30d high, drop %, MA status
- [x] Running totals: total BTC, total USD spent, average cost
- [x] Weekly summary notification
- [x] Health check endpoint with DCA service status
- [x] Daily verification detects missed purchases
- [x] Dry-run mode executes full logic without placing orders
- [x] Dry-run notifications marked clearly as simulated

---

## Phase Dependencies

```
Phase 1 (Foundation) -> Phase 2 (Core DCA) -> Phase 3 (Smart Multipliers) -> Phase 4 (Observability)
```

Strictly sequential — each phase builds on the previous.

## Milestone Summary

**Key Decisions:**
- PostgreSQL advisory locks replace Dapr stub (real distributed locking)
- IOC orders with 5% slippage tolerance for immediate fill
- Multiplicative stacking of multipliers (dip tier * bear boost) with configurable cap
- Stale data policy: use last known values (never reject data)
- Graceful degradation: multiplier calculation failure falls back to 1.0x
- Dry-run mode bypasses idempotency for repeated testing

**Issues Resolved:**
- Distributed lock was stubbed (returns success without acquiring) — fixed with PostgreSQL advisory locks
- Hyperliquid API less documented — researched Python SDK for EIP-712 signing reference

**Technical Debt Incurred:**
- Plan 01-02 has no formal SUMMARY.md (built outside GSD process)
- No automated tests for DCA logic, multipliers, or notification handlers
- BTC balance uses filled quantity approximation (not actual wallet balance query)
- NuGet version mismatch warnings (Nethereum, DistributedLock.Postgres)

---
*For current project status, see .planning/ROADMAP.md*
