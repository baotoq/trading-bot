---
phase: 09.1-migrate-dashboard-to-fresh-nuxt-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Dashboard/package.json
  - TradingBot.Dashboard/nuxt.config.ts
  - TradingBot.Dashboard/app/app.vue
  - TradingBot.Dashboard/app/assets/css/main.css
  - TradingBot.Dashboard/server/api/health.get.ts
  - TradingBot.Dashboard/server/api/portfolio.get.ts
  - TradingBot.Dashboard/server/utils/auth.ts
  - TradingBot.AppHost/AppHost.cs
autonomous: true

must_haves:
  truths:
    - "TradingBot.Dashboard has @nuxt/ui module configured and Tailwind v4 via CSS imports"
    - "Server API routes (health, portfolio) work identically to old dashboard"
    - "API key auth utility exists at server/utils/auth.ts with 401/403 responses"
    - "AppHost.cs points to TradingBot.Dashboard (not dashboard/)"
    - "Old dashboard/ directory is removed"
    - "dotnet build TradingBot.AppHost succeeds"
    - "npx nuxi prepare succeeds in TradingBot.Dashboard"
  artifacts:
    - path: "TradingBot.Dashboard/package.json"
      provides: "Nuxt 4 project with @nuxt/ui dependency"
      contains: "@nuxt/ui"
    - path: "TradingBot.Dashboard/nuxt.config.ts"
      provides: "Full Nuxt config with modules, runtimeConfig, routeRules, TypeScript"
      contains: "routeRules"
    - path: "TradingBot.Dashboard/app/app.vue"
      provides: "Root component with UApp wrapper"
      contains: "UApp"
    - path: "TradingBot.Dashboard/app/assets/css/main.css"
      provides: "Tailwind v4 and Nuxt UI CSS imports"
      contains: "@import"
    - path: "TradingBot.Dashboard/server/api/health.get.ts"
      provides: "Health endpoint for Aspire monitoring"
      contains: "defineEventHandler"
    - path: "TradingBot.Dashboard/server/api/portfolio.get.ts"
      provides: "Portfolio proxy endpoint with server-to-server auth"
      contains: "x-api-key"
    - path: "TradingBot.Dashboard/server/utils/auth.ts"
      provides: "API key validation utility"
      contains: "requireApiKey"
    - path: "TradingBot.AppHost/AppHost.cs"
      provides: "Aspire orchestration pointing to new dashboard path"
      contains: "../TradingBot.Dashboard"
  key_links:
    - from: "TradingBot.AppHost/AppHost.cs"
      to: "TradingBot.Dashboard/"
      via: "AddNodeApp relative path"
      pattern: 'AddNodeApp.*"../TradingBot.Dashboard"'
    - from: "TradingBot.Dashboard/nuxt.config.ts"
      to: "TradingBot.ApiService"
      via: "routeRules proxy and runtimeConfig"
      pattern: "/proxy/api/\\*\\*"
    - from: "TradingBot.Dashboard/server/api/portfolio.get.ts"
      to: "TradingBot.ApiService"
      via: "$fetch with x-api-key header"
      pattern: "x-api-key.*config.apiKey"
---

<objective>
Migrate all Phase 9 dashboard code from old `dashboard/` directory to fresh Nuxt 4 `TradingBot.Dashboard/` project, install missing dependencies, update AppHost path, and remove old directory.

Purpose: The old `dashboard/` was created as Nuxt 3 during Phase 9. A fresh `TradingBot.Dashboard/` was initialized as Nuxt 4 with correct project references structure. This plan migrates the functional code (server routes, config, app component, CSS) to the new location and updates Aspire orchestration.

Output: Fully functional TradingBot.Dashboard/ with all Phase 9 features (proxy, auth, health endpoint, Nuxt UI), Aspire pointing to new path, old dashboard/ deleted.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/09-infrastructure-aspire-integration/09-01-SUMMARY.md
@.planning/phases/09-infrastructure-aspire-integration/09-02-SUMMARY.md
@.planning/phases/09.1-migrate-dashboard-to-fresh-nuxt-setup/09.1-RESEARCH.md

Key facts from research:
- Nuxt 4 uses app/ directory (source already in app/ for both old and new)
- server/ stays at project root (NOT inside app/)
- @nuxt/ui v4 required for Nuxt 4 (v3 from old dashboard is INCOMPATIBLE)
- CSS imports use `@import "tailwindcss"; @import "@nuxt/ui";` (no @nuxtjs/tailwindcss module)
- ~ alias resolves to app/ in Nuxt 4 (CSS path `~/assets/css/main.css` works)
- tsconfig.json in new project uses project references (keep as-is, do NOT overwrite with old format)
- Server code requires ZERO changes between Nuxt 3 and 4
- compatibilityDate should stay at '2025-07-15' (Nuxt 4 date, not old '2024-11-01')
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and migrate dashboard source files</name>
  <files>
    TradingBot.Dashboard/package.json
    TradingBot.Dashboard/nuxt.config.ts
    TradingBot.Dashboard/app/app.vue
    TradingBot.Dashboard/app/assets/css/main.css
    TradingBot.Dashboard/server/api/health.get.ts
    TradingBot.Dashboard/server/api/portfolio.get.ts
    TradingBot.Dashboard/server/utils/auth.ts
  </files>
  <action>
    1. Install @nuxt/ui and TypeScript in TradingBot.Dashboard:
       ```bash
       cd TradingBot.Dashboard && npm install @nuxt/ui@^4.0.0 && npm install --save-dev typescript@^5.6.0
       ```
       Note: Use @nuxt/ui v4 (NOT v3). v3 is incompatible with Nuxt 4 per research. Do NOT install @nuxtjs/tailwindcss or tailwindcss separately -- @nuxt/ui v4 bundles Tailwind v4.

    2. Update TradingBot.Dashboard/nuxt.config.ts to match old dashboard config but with Nuxt 4 compatibilityDate:
       ```typescript
       export default defineNuxtConfig({
         modules: ['@nuxt/ui'],
         css: ['~/assets/css/main.css'],
         runtimeConfig: {
           apiKey: process.env.NUXT_API_KEY || '',
           public: {
             apiEndpoint: process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'
           }
         },
         routeRules: {
           '/proxy/api/**': {
             proxy: `${process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'}/api/**`
           }
         },
         devtools: { enabled: true },
         typescript: { strict: true, typeCheck: false },
         compatibilityDate: '2025-07-15'
       })
       ```
       IMPORTANT: Keep compatibilityDate as '2025-07-15' (Nuxt 4), NOT '2024-11-01' (old Nuxt 3).

    3. Replace TradingBot.Dashboard/app/app.vue with UApp wrapper version:
       ```vue
       <template>
         <UApp>
           <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
             <div class="flex items-center justify-center min-h-screen">
               <div class="text-center">
                 <h1 class="text-4xl font-bold text-gray-900 dark:text-white">
                   BTC Smart DCA Dashboard
                 </h1>
                 <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
                   Dashboard is running
                 </p>
               </div>
             </div>
           </div>
         </UApp>
       </template>
       ```

    4. Create TradingBot.Dashboard/app/assets/css/main.css:
       ```css
       @import "tailwindcss";
       @import "@nuxt/ui";
       ```
       Note: Must be at app/assets/css/main.css (inside app/ directory for Nuxt 4).

    5. Create server directory structure and copy server files (these stay at root, NOT inside app/):
       - Create TradingBot.Dashboard/server/api/ and TradingBot.Dashboard/server/utils/ directories
       - Copy health.get.ts, portfolio.get.ts, and auth.ts from old dashboard/server/ to new location
       - Files require ZERO modifications (server code is identical between Nuxt 3 and 4)

    6. Run `cd TradingBot.Dashboard && npx nuxi prepare` to verify types generate correctly.

    DO NOT modify tsconfig.json -- the fresh Nuxt 4 project references structure is correct.
  </action>
  <verify>
    1. `cd TradingBot.Dashboard && npx nuxi prepare` completes without errors
    2. `grep -q "@nuxt/ui" TradingBot.Dashboard/package.json` succeeds (dependency installed)
    3. `grep -q "routeRules" TradingBot.Dashboard/nuxt.config.ts` succeeds (proxy configured)
    4. `grep -q "UApp" TradingBot.Dashboard/app/app.vue` succeeds (component wrapper present)
    5. `test -f TradingBot.Dashboard/app/assets/css/main.css` succeeds (CSS file exists)
    6. `test -f TradingBot.Dashboard/server/api/health.get.ts` succeeds (health endpoint exists)
    7. `test -f TradingBot.Dashboard/server/api/portfolio.get.ts` succeeds (portfolio endpoint exists)
    8. `test -f TradingBot.Dashboard/server/utils/auth.ts` succeeds (auth utility exists)
    9. `grep -q "requireApiKey" TradingBot.Dashboard/server/utils/auth.ts` succeeds (function exported)
  </verify>
  <done>
    TradingBot.Dashboard has all Phase 9 features: @nuxt/ui module, Tailwind v4 via CSS imports, runtimeConfig with apiKey and public.apiEndpoint, routeRules proxy for /proxy/api/**, health endpoint, portfolio endpoint with server-to-server auth, and requireApiKey utility. npx nuxi prepare succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Aspire AppHost path and remove old dashboard directory</name>
  <files>
    TradingBot.AppHost/AppHost.cs
  </files>
  <action>
    1. Update TradingBot.AppHost/AppHost.cs: Change the AddNodeApp path from "../dashboard" to "../TradingBot.Dashboard":
       ```csharp
       // Before:
       var dashboard = builder.AddNodeApp("dashboard", "../dashboard", "dev")
       // After:
       var dashboard = builder.AddNodeApp("dashboard", "../TradingBot.Dashboard", "dev")
       ```
       Only change the path string. Everything else stays identical (port 3000, env vars, references, WaitFor).

    2. Run `dotnet build TradingBot.AppHost` to verify the build succeeds with the new path.

    3. Delete the old dashboard/ directory:
       ```bash
       rm -rf dashboard/
       ```

    4. Verify old directory is gone: `test ! -d dashboard/`
  </action>
  <verify>
    1. `grep -q "../TradingBot.Dashboard" TradingBot.AppHost/AppHost.cs` succeeds (new path)
    2. `grep -qv "../dashboard\"" TradingBot.AppHost/AppHost.cs` or verify no reference to old path remains (only the new path)
    3. `dotnet build TradingBot.AppHost` succeeds with exit code 0
    4. `test ! -d dashboard/` succeeds (old directory removed)
  </verify>
  <done>
    AppHost.cs points to TradingBot.Dashboard (not old dashboard/), dotnet build succeeds, old dashboard/ directory is deleted. INFR-01 through INFR-04 remain satisfied with new directory structure.
  </done>
</task>

</tasks>

<verification>
1. `cd TradingBot.Dashboard && npx nuxi prepare` completes without errors (Nuxt 4 types generate)
2. `dotnet build TradingBot.AppHost` succeeds (Aspire orchestration valid)
3. `grep "../TradingBot.Dashboard" TradingBot.AppHost/AppHost.cs` shows new path
4. `test ! -d dashboard/` confirms old directory removed
5. All server files exist: health.get.ts, portfolio.get.ts, server/utils/auth.ts
6. nuxt.config.ts has: @nuxt/ui module, runtimeConfig, routeRules, compatibilityDate '2025-07-15'
7. app.vue has UApp wrapper
8. app/assets/css/main.css has Tailwind v4 and Nuxt UI imports
</verification>

<success_criteria>
- TradingBot.Dashboard is a fully functional Nuxt 4 project with all Phase 9 features migrated
- AppHost.cs references TradingBot.Dashboard (not dashboard/)
- Old dashboard/ directory no longer exists
- INFR-01 through INFR-04 requirements remain satisfied
- Both `npx nuxi prepare` and `dotnet build TradingBot.AppHost` succeed
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-migrate-dashboard-to-fresh-nuxt-setup/09.1-01-SUMMARY.md`
</output>
