---
phase: 21-portfolio-status-screens
verified: 2026-02-20T08:00:00Z
status: passed
score: 5/5 must-haves verified
re_verification: false
---

# Phase 21: Portfolio Status Screens Verification Report

**Phase Goal:** Users can see their full portfolio position and confirm the bot is alive, with live price and a countdown to the next buy
**Verified:** 2026-02-20T08:00:00Z
**Status:** passed
**Re-verification:** No — initial verification

---

## Goal Achievement

### Observable Truths (from Success Criteria)

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | User can see total BTC accumulated, total cost in USD, and unrealized P&L (green/red) on the home screen | VERIFIED | `PortfolioStatsSection` renders `totalBtc`, `totalCost`, and `_PnlText` with `AppTheme.profitGreen`/`lossRed` coloring |
| 2 | Live BTC price refreshes automatically every 30 seconds without user interaction | VERIFIED | `homeDataProvider` sets `Timer(Duration(seconds: 30), ref.invalidateSelf)` with `ref.onDispose(timer.cancel)` |
| 3 | Bot health status badge (healthy/warning/down) is always visible and reflects the current API health response | VERIFIED | `HealthBadge` placed in `SliverAppBar` actions; rendered in both `AsyncData` and `AsyncError+cachedValue` branches |
| 4 | A countdown timer shows time remaining until the next scheduled buy, counting down in real time client-side | VERIFIED | `CountdownText` parses `nextBuyTime` ISO 8601, computes `DateTime.now().toUtc()` diff, renders "~X days/hours/minutes" |
| 5 | A last buy detail card shows the most recent purchase's date, price, BTC amount, multiplier used, and drop percentage | VERIFIED | `LastBuyCard` renders `relativeTime`, `headlineSmall` price, BTC amount, `_MultiplierBadge`, and `_DropPercentText` |

**Score:** 5/5 truths verified

---

### Required Artifacts

#### Plan 21-01 Artifacts

| Artifact | Status | Details |
|----------|--------|---------|
| `TradingBot.Mobile/lib/features/home/data/models/portfolio_response.dart` | VERIFIED | 9 fields matching .NET `PortfolioResponse`, manual `fromJson` factory, proper nullable handling |
| `TradingBot.Mobile/lib/features/home/data/models/status_response.dart` | VERIFIED | 9 fields matching .NET `LiveStatusResponse` (including `lastPurchaseMultiplier` and `lastPurchaseDropPercentage`), manual `fromJson` |
| `TradingBot.Mobile/lib/features/home/data/home_repository.dart` | VERIFIED | `HomeRepository` with `fetchPortfolio()` and `fetchStatus()` Dio GET calls; imports `PortfolioResponse` and `StatusResponse` |
| `TradingBot.Mobile/lib/features/home/data/home_providers.dart` | VERIFIED | `HomeData` class, `homeRepositoryProvider`, `homeDataProvider` with `Timer(30s, ref.invalidateSelf)` and `ref.onDispose` |
| `TradingBot.Mobile/lib/features/home/data/home_providers.g.dart` | VERIFIED | Code-generated by `riverpod_annotation`; exports `homeRepositoryProvider` and `homeDataProvider` |

#### Plan 21-02 Artifacts

| Artifact | Status | Details |
|----------|--------|---------|
| `TradingBot.Mobile/lib/features/home/presentation/home_screen.dart` | VERIFIED | Full layout: `SliverAppBar` + `RefreshIndicator` + `AsyncValue` switch; imports and uses all 4 widgets |
| `TradingBot.Mobile/lib/features/home/presentation/widgets/portfolio_stats_section.dart` | VERIFIED | Hero portfolio value, 2x2 `GridView` stat cards (Total BTC, Total Cost, Current Price, Avg Cost), P&L with color coding |
| `TradingBot.Mobile/lib/features/home/presentation/widgets/health_badge.dart` | VERIFIED | 3-state badge (Healthy=green, Warning=amber, else=red) via `switch` on `healthStatus.toLowerCase()` |
| `TradingBot.Mobile/lib/features/home/presentation/widgets/countdown_text.dart` | VERIFIED | Parses ISO 8601 string, computes diff, renders approximate text; handles null and past times |
| `TradingBot.Mobile/lib/features/home/presentation/widgets/last_buy_card.dart` | VERIFIED | Price as `headlineSmall`, BTC amount, `_MultiplierBadge` (bitcoinOrange for >1x), `_DropPercentText` with 4-tier severity |

#### Backend Artifacts

| Artifact | Status | Details |
|----------|--------|---------|
| `TradingBot.ApiService/Endpoints/DashboardDtos.cs` | VERIFIED | `LiveStatusResponse` includes `LastPurchaseMultiplier` and `LastPurchaseDropPercentage` as nullable fields |
| `TradingBot.ApiService/Endpoints/DashboardEndpoints.cs` | VERIFIED | `GetLiveStatusAsync` populates both new fields via `lastPurchase?.Multiplier` and `lastPurchase?.DropPercentage` |

---

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| `home_repository.dart` | `/api/dashboard/portfolio` | `_dio.get('/api/dashboard/portfolio')` | WIRED | Direct `Dio.get` call with response parsed via `PortfolioResponse.fromJson` |
| `home_repository.dart` | `/api/dashboard/status` | `_dio.get('/api/dashboard/status')` | WIRED | Direct `Dio.get` call with response parsed via `StatusResponse.fromJson` |
| `DashboardEndpoints.cs` | `DashboardDtos.cs` | `LiveStatusResponse` with multiplier/drop fields | WIRED | Lines 187-188: `LastPurchaseMultiplier: lastPurchase?.Multiplier` and `LastPurchaseDropPercentage: lastPurchase?.DropPercentage` |
| `home_screen.dart` | `home_providers.dart` | `ref.watch(homeDataProvider)` | WIRED | Line 18 of `home_screen.dart`: `final homeData = ref.watch(homeDataProvider)` |
| `portfolio_stats_section.dart` | `portfolio_response.dart` | `PortfolioResponse` parameter | WIRED | Constructor takes `final PortfolioResponse portfolio`; fields accessed directly |
| `last_buy_card.dart` | `status_response.dart` | `StatusResponse` fields | WIRED | Constructor takes `final StatusResponse status`; `lastPurchaseTime`, `lastPurchasePrice`, `lastPurchaseBtc`, `lastPurchaseMultiplier`, `lastPurchaseDropPercentage` all accessed |

---

### Requirements Coverage

| Requirement | Source Plan | Description | Status | Evidence |
|-------------|-------------|-------------|--------|---------|
| PORT-01 | 21-01 + 21-02 | User can view total BTC accumulated, total cost, and unrealized P&L on home screen | SATISFIED | `PortfolioStatsSection` displays all three; P&L colored green/red via `AppTheme` constants |
| PORT-02 | 21-01 + 21-02 | User can see live BTC price updated every 30 seconds | SATISFIED | 30s `Timer` in `homeDataProvider` calls `ref.invalidateSelf()` to trigger silent re-fetch; `currentPrice` displayed in stat card |
| PORT-03 | 21-02 | User can see bot health status badge (healthy/warning/down) always visible | SATISFIED | `HealthBadge` in `SliverAppBar` actions; shown in `AsyncData` AND `AsyncError+cachedValue` branches — always visible when data available |
| PORT-04 | 21-02 | User can see countdown timer to next scheduled buy | SATISFIED | `CountdownText` widget with human-readable approximate countdown ("~X hours") from `nextBuyTime` API field |
| PORT-05 | 21-02 | User can see last buy detail card (date, price, BTC amount, multiplier, drop %) | SATISFIED | `LastBuyCard` shows all 5 fields: relative date (`timeago`), price (`headlineSmall`), BTC amount, `_MultiplierBadge`, `_DropPercentText` |

No orphaned requirements found. All 5 PORT requirements are mapped to Phase 21 in REQUIREMENTS.md (lines 98-102) and all are satisfied.

---

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| `last_buy_card.dart` | 11 | Word "placeholder" in doc comment | Info | Comment documents the empty state UI text "No purchases yet" — this is intentional UI copy, not a stub |

No blocking or warning anti-patterns found. The doc comment flagged is a false positive from the word "placeholder" appearing in a legitimate code comment about the empty state display.

---

### Human Verification Required

#### 1. P&L Color Rendering

**Test:** Run the app with a portfolio that has unrealized profit and one with unrealized loss.
**Expected:** P&L text is green with a "+" prefix for profit; red with a "-" for loss; white/neutral for zero.
**Why human:** Color rendering requires a device or simulator; cannot assert visual color from static analysis.

#### 2. Health Badge Visibility During Scroll

**Test:** Load the home screen with data, then scroll down past the portfolio stats section.
**Expected:** Health badge remains visible in the `SliverAppBar` as it floats/snaps while scrolling.
**Why human:** `SliverAppBar` with `floating: true, snap: true` behavior is a runtime scroll interaction.

#### 3. 30-Second Silent Refresh

**Test:** Open the home screen, wait 30 seconds without interaction.
**Expected:** Numbers update without any visible flash, spinner, or scroll jump — data updates in place.
**Why human:** Requires real-time observation of the silent timer re-fetch behavior at runtime.

#### 4. Countdown Text Accuracy

**Test:** Open the app when a buy is scheduled within the next hour and again when scheduled tomorrow.
**Expected:** Shows "Next buy in ~X minutes" (< 1 hour), "Next buy in ~X hours" (1-24 hours), "Next buy in ~X days" (> 24 hours).
**Why human:** Requires a live API connection with a known `nextBuyTime` value and clock observation.

#### 5. Last Buy Card Multiplier Badge Color

**Test:** View the last buy card for a purchase with multiplier > 1.0 and for one with 1.0x (base).
**Expected:** >1.0 multiplier shows `bitcoinOrange` badge; 1.0x shows grey badge.
**Why human:** Color rendering requires visual inspection on device or simulator.

---

### Note on Field Count Discrepancy

The Plan 21-01 frontmatter stated "StatusResponse Dart model (11 fields)." The actual Dart `StatusResponse` has **9 fields**, which exactly mirrors the .NET `LiveStatusResponse` (also 9 fields). The plan's field count claim was a documentation error; the implementation is correct. All 9 fields are present and match the .NET DTO 1:1.

---

### Gaps Summary

No gaps. All automated checks passed:

- All 10 required files exist and contain substantive implementations (no stubs, no placeholder returns)
- All 6 key links are wired: Dio GET calls to `/portfolio` and `/status`, .NET DTO extended with multiplier fields, `HomeScreen` watches `homeDataProvider`, and both widget components take correctly-typed model parameters
- All 5 PORT requirements (PORT-01 through PORT-05) are satisfied by concrete implementations
- No blocking anti-patterns found
- All 4 task commits verified in git history (`d258baf`, `2ebbd1f`, `bd1c469`, `390ef62`)
- `timeago: ^3.7.0` and `intl: any` confirmed in `pubspec.yaml`
- No stale `part` directive in `home_screen.dart`
- No TODO/FIXME stubs in any implementation file

---

_Verified: 2026-02-20T08:00:00Z_
_Verifier: Claude (gsd-verifier)_
