---
milestone: v4.0
audited: 2026-02-20
status: gaps_found
scores:
  requirements: 0/20
  phases: 0/4
  integration: 17/20
  flows: 6/8
gaps:
  requirements:
    - id: "PORT-01"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-01-PLAN.md", "26-03-PLAN.md"]
      completed_by_plans: ["26-01-SUMMARY.md", "26-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Domain model and EF persistence exist, but no POST /api/portfolio/assets endpoint. Users cannot create portfolio assets from the Flutter app — assets must be manually seeded in the database."
    - id: "PORT-02"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-01-PLAN.md"]
      completed_by_plans: ["26-01-SUMMARY.md", "26-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "POST /api/portfolio/assets/{id}/transactions wired end-to-end. No VERIFICATION.md exists."
    - id: "PORT-03"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-01-PLAN.md"]
      completed_by_plans: ["26-01-SUMMARY.md", "26-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Domain model exists but Flutter sends 'None' for CompoundingFrequency while backend enum is 'Simple'. POST /api/portfolio/fixed-deposits returns 400 for simple-interest deposits."
    - id: "PORT-04"
      status: "partial"
      phase: "Phase 28"
      claimed_by_plans: ["28-01-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "PortfolioPurchaseCompletedEventHandler wired via MediatR. No requirements-completed frontmatter in SUMMARY.md, no VERIFICATION.md."
    - id: "PORT-05"
      status: "partial"
      phase: "Phase 28"
      claimed_by_plans: ["28-01-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "HistoricalPurchaseMigrator triggered from GetSummaryAsync. No requirements-completed frontmatter in SUMMARY.md, no VERIFICATION.md."
    - id: "PORT-06"
      status: "partial"
      phase: "Phase 26"
      claimed_by_plans: ["26-02-PLAN.md"]
      completed_by_plans: ["26-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "InterestCalculator implemented with 8 passing unit tests. No VERIFICATION.md."
    - id: "PRICE-01"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-01-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "CoinGeckoPriceProvider with 5-min freshness/30-day TTL. No requirements-completed frontmatter, no VERIFICATION.md."
    - id: "PRICE-02"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-02-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "VNDirectPriceProvider with 48h stale-while-revalidate. No requirements-completed frontmatter, no VERIFICATION.md."
    - id: "PRICE-03"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-02-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "OpenErApiProvider with 12h TTL. No requirements-completed frontmatter, no VERIFICATION.md."
    - id: "PRICE-04"
      status: "partial"
      phase: "Phase 27"
      claimed_by_plans: ["27-01-PLAN.md", "27-02-PLAN.md"]
      completed_by_plans: []
      verification_status: "missing"
      evidence: "PriceFeedResult.IsStale propagated to Flutter StalenessLabel. No requirements-completed frontmatter, no VERIFICATION.md."
    - id: "DISP-01"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-01-PLAN.md"]
      completed_by_plans: ["29-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "CurrencyPreference with SharedPreferences persistence implemented. No VERIFICATION.md."
    - id: "DISP-02"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "AssetTypeSection + AssetRow with P&L grouping implemented. No VERIFICATION.md."
    - id: "DISP-03"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "AllocationDonutChart implemented. Tooltip may show USD value with VND formatter in VND mode. No VERIFICATION.md."
    - id: "DISP-04"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-03-PLAN.md"]
      completed_by_plans: ["29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "AddTransactionScreen wired to POST endpoint. No VERIFICATION.md."
    - id: "DISP-05"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-03-PLAN.md"]
      completed_by_plans: ["29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Fixed deposit form sends 'None' instead of 'Simple' for CompoundingFrequency. Backend returns 400."
    - id: "DISP-06"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-01-PLAN.md", "29-03-PLAN.md"]
      completed_by_plans: ["29-01-SUMMARY.md", "29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "TransactionHistoryScreen with filters implemented. No VERIFICATION.md."
    - id: "DISP-07"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md", "29-03-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md", "29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "FixedDepositDetailScreen with progress bar and computed values. No VERIFICATION.md."
    - id: "DISP-08"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-03-PLAN.md"]
      completed_by_plans: ["29-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Bot badge checking transaction.source == 'Bot', no edit/delete controls. No VERIFICATION.md."
    - id: "DISP-09"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "StalenessLabel widget for stale prices. No VERIFICATION.md."
    - id: "DISP-10"
      status: "partial"
      phase: "Phase 29"
      claimed_by_plans: ["29-02-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Cross-currency 'converted at today's rate' label implemented. No VERIFICATION.md."
  integration:
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "CompoundingFrequency enum mismatch: Flutter sends 'None', backend expects 'Simple'. Affects PORT-03, DISP-05."
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "AllocationDonutChart tooltip may show USD value with VND formatter in VND mode. Affects DISP-03."
    - from: "Phase 29 (Flutter)"
      to: "Phase 28 (Backend)"
      issue: "No POST /api/portfolio/assets endpoint. No Flutter UI to create assets. Assets must be DB-seeded. Affects PORT-01."
  flows:
    - flow: "Create Fixed Deposit (Simple Interest)"
      breaks_at: "Flutter form sends 'None' → POST /api/portfolio/fixed-deposits → Enum.TryParse('None') fails → 400 Bad Request"
    - flow: "Donut Chart VND Tooltip"
      breaks_at: "AllocationDonutChart._buildTooltip formats USD value with VND formatter in VND mode"
tech_debt:
  - phase: 27-price-feed-infrastructure
    items:
      - "Static CoinGecko ID dictionary (only BTC/ETH mapped) — new crypto tickers return price 0"
      - "VNDirect dchart-api is undocumented/unofficial — could change without notice"
      - "No unit tests for price feed providers"
      - "SUMMARY.md frontmatter missing requirements-completed for PRICE-01..04"
  - phase: 28-portfolio-backend-api
    items:
      - "No unit/integration tests for portfolio endpoints"
      - "SUMMARY.md frontmatter missing requirements-completed for PORT-04, PORT-05"
      - "PUT/DELETE fixed deposit endpoints exist but have no Flutter UI"
      - "Exchange rate failure defaults to 0 (VND values show as 0)"
      - "HistoricalPurchaseMigrator loads all transactions in memory"
  - phase: 29-flutter-portfolio-ui
    items:
      - "No Flutter widget/integration tests"
      - "Transaction history fetches per-asset and merges client-side (O(N) API calls)"
      - "PortfolioRepository lacks updateFixedDeposit/deleteFixedDeposit methods"
      - "Edit/delete controls absent from all transactions (not just bot-imported)"
  - all_phases:
    items:
      - "No VERIFICATION.md for any of the 4 phases — all formally unverified"
      - "REQUIREMENTS.md traceability still shows all 20 requirements as [ ] Pending"
---

# v4.0 Portfolio Tracker — Milestone Audit

**Audited:** 2026-02-20
**Status:** GAPS FOUND
**Milestone Goal:** Multi-asset portfolio tracking (crypto, VN30 ETF, fixed deposits) with live prices, P&L, and multi-currency support (VND/USD) in the Flutter app.

## Scores

| Dimension | Score | Notes |
|-----------|-------|-------|
| Requirements | 0/20 satisfied | All 20 partial — no 3-source confirmation possible (all VERIFICATION.md missing) |
| Phases | 0/4 verified | No VERIFICATION.md created for any phase |
| Integration | 17/20 wired | 3 integration gaps (enum mismatch, tooltip bug, missing endpoint) |
| E2E Flows | 6/8 complete | 2 broken flows |

## Phase Verification Status

| Phase | Plans | VERIFICATION.md | Status |
|-------|-------|-----------------|--------|
| 26 — Portfolio Domain Foundation | 3/3 executed | **MISSING** | Unverified |
| 27 — Price Feed Infrastructure | 2/2 executed | **MISSING** | Unverified |
| 28 — Portfolio Backend API | 2/2 executed | **MISSING** | Unverified |
| 29 — Flutter Portfolio UI | 3/3 executed | **MISSING** | Unverified |

**All 4 phases are formally unverified** — no VERIFICATION.md files were created during execution.

## Requirements Cross-Reference (3-Source)

### Source Legend
- **V** = VERIFICATION.md status (all missing)
- **S** = SUMMARY.md frontmatter `requirements-completed`
- **R** = REQUIREMENTS.md traceability checkbox
- **I** = Integration checker wiring assessment

| REQ-ID | V | S | R | I | Final Status | Notes |
|--------|---|---|---|---|--------------|-------|
| PORT-01 | - | listed | [ ] | PARTIAL | **partial** | No create asset endpoint; DB seeding required |
| PORT-02 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| PORT-03 | - | listed | [ ] | BROKEN | **partial** | Enum mismatch: Flutter 'None' vs backend 'Simple' |
| PORT-04 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| PORT-05 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| PORT-06 | - | listed | [ ] | WIRED | **partial** | 8 unit tests pass; verification gap |
| PRICE-01 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| PRICE-02 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| PRICE-03 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| PRICE-04 | - | - | [ ] | WIRED | **partial** | SUMMARY frontmatter missing; code wired |
| DISP-01 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-02 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-03 | - | listed | [ ] | PARTIAL | **partial** | Tooltip may show USD as VND in VND mode |
| DISP-04 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-05 | - | listed | [ ] | BROKEN | **partial** | Enum mismatch blocks simple-interest FD creation |
| DISP-06 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-07 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-08 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-09 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |
| DISP-10 | - | listed | [ ] | WIRED | **partial** | Verification gap — code works |

### Gap Categories

**Critical — Code Bugs (3 requirements affected):**
1. **PORT-03 / DISP-05**: CompoundingFrequency enum mismatch — Flutter sends `'None'`, backend expects `'Simple'`. 400 error on simple-interest fixed deposit creation.
2. **DISP-03**: AllocationDonutChart tooltip may format USD value with VND formatter in VND mode.
3. **PORT-01**: No `POST /api/portfolio/assets` endpoint. Users cannot create portfolio assets from Flutter app.

**Verification Gaps (all 20 requirements):**
- No VERIFICATION.md for any phase
- 6 requirements missing from SUMMARY frontmatter (PRICE-01..04, PORT-04, PORT-05)
- REQUIREMENTS.md traceability shows all 20 as `[ ] Pending`

## Cross-Phase Integration

### Wiring Summary
- **Connected:** 17/20 requirement integration paths fully wired
- **Broken:** 2 flows (enum mismatch, tooltip bug)
- **Gap:** 1 flow (no asset creation endpoint)

### Verified Connections
- Phase 26 → 28: All domain entities, InterestCalculator, typed IDs consumed correctly
- Phase 27 → 28: All 3 price providers (Crypto, ETF, ExchangeRate) injected and called
- Phase 28 → 29: All 9 API routes consumed by Flutter PortfolioRepository
- Phase 28 auto-import: PurchaseCompletedEvent → PortfolioPurchaseCompletedEventHandler via MediatR
- Phase 29 internal: GoRouter routes, providers, SharedPreferences all wired correctly

### E2E Flows

| Flow | Status | Break Point |
|------|--------|-------------|
| View portfolio summary | Complete | — |
| Toggle VND/USD currency | Complete | — |
| Add manual transaction | Complete | — |
| Create fixed deposit (compound) | Complete | Monthly/Quarterly/SemiAnnual/Annual work |
| **Create fixed deposit (simple)** | **BROKEN** | Flutter 'None' → Enum.TryParse fails → 400 |
| View transaction history | Complete | — |
| View fixed deposit detail | Complete | — |
| **Donut chart VND tooltip** | **BROKEN** | USD value formatted as VND in VND mode |

### API Route Coverage

| Route | Backend | Flutter Repo | Flutter UI |
|-------|---------|-------------|------------|
| GET /api/portfolio/summary | Yes | Yes | Yes |
| GET /api/portfolio/assets | Yes | Yes | Yes |
| GET /api/portfolio/assets/{id}/transactions | Yes | Yes | Yes |
| POST /api/portfolio/assets/{id}/transactions | Yes | Yes | Yes |
| GET /api/portfolio/fixed-deposits | Yes | Yes | Yes |
| GET /api/portfolio/fixed-deposits/{id} | Yes | Yes | Yes |
| POST /api/portfolio/fixed-deposits | Yes | Yes | Yes (broken) |
| PUT /api/portfolio/fixed-deposits/{id} | Yes | **No** | **No** |
| DELETE /api/portfolio/fixed-deposits/{id} | Yes | **No** | **No** |

## Tech Debt

### Phase 27: Price Feed Infrastructure (4 items)
- Static CoinGecko ID dictionary (only BTC/ETH mapped) — new crypto tickers return price 0
- VNDirect dchart-api is undocumented/unofficial — could change without notice
- No unit tests for price feed providers
- SUMMARY frontmatter missing `requirements-completed` for PRICE-01..04

### Phase 28: Portfolio Backend API (5 items)
- No unit/integration tests for portfolio endpoints
- SUMMARY frontmatter missing `requirements-completed` for PORT-04, PORT-05
- PUT/DELETE fixed deposit endpoints have no Flutter UI consumer
- Exchange rate failure defaults to 0 (VND values show as 0)
- HistoricalPurchaseMigrator loads all transactions in memory

### Phase 29: Flutter Portfolio UI (4 items)
- No Flutter widget/integration tests
- Transaction history fetches per-asset and merges client-side (O(N) API calls)
- PortfolioRepository lacks updateFixedDeposit/deleteFixedDeposit methods
- Edit/delete controls absent from all transactions (not just bot-imported)

### Cross-Phase (2 items)
- No VERIFICATION.md for any of the 4 phases
- REQUIREMENTS.md traceability still shows all 20 as `[ ] Pending`

**Total: 15 tech debt items across 4 phases**

---
*Audit completed: 2026-02-20*
