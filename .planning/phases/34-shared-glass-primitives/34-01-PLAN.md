---
phase: 34-shared-glass-primitives
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/lib/core/widgets/glass_card.dart
  - TradingBot.Mobile/lib/core/widgets/pressable_scale.dart
autonomous: true
requirements: [ANIM-04]

must_haves:
  truths:
    - "GlassCard renders a non-blur tint+border surface when variant is scrollItem, without any change at the call site beyond passing variant"
    - "GlassCard renders full BackdropFilter frosted glass when variant is stationary (default)"
    - "Tapping a PressableScale-wrapped widget produces a visible press-scale shrink to 0.97 with a haptic pulse, then springs back on release"
    - "PressableScale respects GlassCard.shouldReduceMotion — no animation plays when Reduce Motion is enabled"
  artifacts:
    - path: "TradingBot.Mobile/lib/core/widgets/glass_card.dart"
      provides: "GlassCard with GlassVariant.stationary and GlassVariant.scrollItem rendering modes"
      contains: "GlassVariant"
    - path: "TradingBot.Mobile/lib/core/widgets/pressable_scale.dart"
      provides: "PressableScale wrapper widget with scale animation and HapticFeedback"
      contains: "PressableScale"
  key_links:
    - from: "TradingBot.Mobile/lib/core/widgets/glass_card.dart"
      to: "GlassTheme tokens"
      via: "Theme.of(context).extension<GlassTheme>()!"
      pattern: "extension<GlassTheme>"
    - from: "TradingBot.Mobile/lib/core/widgets/pressable_scale.dart"
      to: "GlassCard.shouldReduceMotion"
      via: "accessibility gate before animation"
      pattern: "GlassCard\\.shouldReduceMotion"
---

<objective>
Add the GlassCard scroll-safe variant (non-blur tint+border for scrollable lists) and create a PressableScale micro-interaction wrapper widget — the two remaining shared primitives before shimmer skeletons.

Purpose: Phase 34 success criteria require GlassCard to auto-select blur vs non-blur rendering based on a variant enum, and all tappable cards to have press-scale + haptic feedback. These are reusable primitives adopted by all 5 feature screen phases (35-38).

Output: Updated GlassCard with GlassVariant enum, new PressableScale widget file.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/33-design-system-foundation/33-02-SUMMARY.md
@TradingBot.Mobile/lib/core/widgets/glass_card.dart
@TradingBot.Mobile/lib/app/theme.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GlassVariant enum and scroll-safe rendering path to GlassCard</name>
  <files>TradingBot.Mobile/lib/core/widgets/glass_card.dart</files>
  <action>
Add a `GlassVariant` enum at the top of the file with two values:
- `stationary` — full BackdropFilter frosted glass (current behavior, default)
- `scrollItem` — non-blur tint+border surface for scrollable list items (no BackdropFilter)

Add a `variant` parameter to GlassCard constructor, defaulting to `GlassVariant.stationary`.

In the `build` method, after the `reduceTransparency` check, add a branch for `variant == GlassVariant.scrollItem`. The scrollItem path renders:
- A Container with the same glass tint color at the same opacity (glass.tintColor.withAlpha((glass.tintOpacity * 255).round()))
- Same border (glass.borderColor, glass.borderWidth)
- Same corner radius
- NO BackdropFilter, NO ClipRRect wrapping
- Same padding and margin handling

This ensures scrollable lists (History, Portfolio) can use `GlassCard(variant: GlassVariant.scrollItem, child: ...)` and get the non-blur surface automatically, while stationary cards (dashboards, hero sections) keep the full frosted glass effect.

The existing default behavior (stationary variant) must remain identical — this is additive only.

Update the class doc comment to document the variant parameter and when to use each value. Mention the Impeller frame drop reason for scrollItem (per project decision: "No BackdropFilter in scrollable lists — Impeller frame drops confirmed").
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` — must pass with no errors. Verify the file contains `enum GlassVariant`, the constructor has `this.variant = GlassVariant.stationary`, and the build method has three rendering paths (reduceTransparency, scrollItem, stationary glass).
  </verify>
  <done>GlassCard accepts a `variant` parameter. Default (stationary) renders BackdropFilter frosted glass exactly as before. scrollItem renders non-blur tint+border surface with no BackdropFilter. Both paths use GlassTheme tokens exclusively.</done>
</task>

<task type="auto">
  <name>Task 2: Create PressableScale micro-interaction wrapper widget</name>
  <files>TradingBot.Mobile/lib/core/widgets/pressable_scale.dart</files>
  <action>
Create a new `PressableScale` widget in `lib/core/widgets/pressable_scale.dart`.

This is a `StatefulWidget` (needs AnimationController) that wraps any child and provides:
1. **Scale animation** — on tap down, scale shrinks to 0.97 over ~100ms with `Curves.easeInOut`; on tap up/cancel, springs back to 1.0 over ~150ms.
2. **Haptic feedback** — on tap down, trigger `HapticFeedback.lightImpact()` (import from `package:flutter/services.dart`).
3. **onTap callback** — optional `VoidCallback? onTap` parameter passed through to GestureDetector's onTap.
4. **Accessibility gate** — in `initState`, check `GlassCard.shouldReduceMotion(context)`. If true, skip all animation (just pass through the child with GestureDetector for onTap only, no scale transform). Note: since shouldReduceMotion needs context, do the check in `didChangeDependencies` instead of `initState`.

Implementation details:
- Use `AnimationController` with `vsync: this` (SingleTickerProviderStateMixin).
- Use `Tween<double>(begin: 1.0, end: 0.97)` with a `CurvedAnimation(curve: Curves.easeInOut)`.
- Wrap child in `AnimatedBuilder` + `Transform.scale` using the animation value.
- GestureDetector wraps the Transform.scale:
  - `onTapDown` → `HapticFeedback.lightImpact()` then `_controller.forward()`
  - `onTapUp` → `_controller.reverse()`
  - `onTapCancel` → `_controller.reverse()`
  - `onTap` → call the `onTap` callback
- Duration: forward 100ms, reverse 150ms. Set controller duration to 100ms, use `_controller.reverse()` which will take the same duration (or set `reverseDuration` on the controller to 150ms if supported — check: `AnimationController` does not have `reverseDuration` constructor param. Instead, use `_controller.animateBack(0.0, duration: Duration(milliseconds: 150))` for the reverse, or just use `_controller.reverse()` with the single 100ms duration for simplicity. Keep it simple: use 100ms for both directions).
- Dispose the controller in `dispose()`.
- Add `behavior: HitTestBehavior.opaque` on GestureDetector so the entire area is tappable.

Doc comment explaining: "Wraps a child widget with a press-scale micro-interaction. On tap down, shrinks to 0.97 scale with haptic pulse. On release, springs back to 1.0. Respects Reduce Motion accessibility setting."

Import glass_card.dart for `GlassCard.shouldReduceMotion`.
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` — must pass with no errors. Verify the file exports `PressableScale`, has `AnimationController`, `HapticFeedback.lightImpact()`, `Transform.scale`, and the `GlassCard.shouldReduceMotion` accessibility gate.
  </verify>
  <done>PressableScale widget exists at `lib/core/widgets/pressable_scale.dart`. Wrapping any widget with `PressableScale(onTap: ..., child: ...)` produces visible press-scale shrink to ~0.97 with haptic pulse on tap, springs back on release. Animation is skipped when Reduce Motion is enabled.</done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with no errors in TradingBot.Mobile
2. GlassCard with default variant renders identically to Phase 33 output (no regression)
3. GlassCard with `variant: GlassVariant.scrollItem` renders without BackdropFilter
4. PressableScale widget exists and compiles cleanly
5. PressableScale references GlassCard.shouldReduceMotion for accessibility
</verification>

<success_criteria>
- GlassCard has GlassVariant enum with stationary (default, blur) and scrollItem (no blur) variants
- PressableScale wrapper widget provides press-scale micro-interaction with haptic feedback
- Both widgets respect existing GlassTheme tokens and accessibility patterns from Phase 33
- `flutter analyze` passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-shared-glass-primitives/34-01-SUMMARY.md`
</output>
