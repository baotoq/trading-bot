---
phase: 34-shared-glass-primitives
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/pubspec.yaml
  - TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart
  - TradingBot.Mobile/lib/features/home/presentation/home_screen.dart
  - TradingBot.Mobile/lib/features/chart/presentation/chart_screen.dart
  - TradingBot.Mobile/lib/features/history/presentation/history_screen.dart
  - TradingBot.Mobile/lib/features/config/presentation/config_screen.dart
  - TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart
autonomous: true
requirements: [ANIM-01]

must_haves:
  truths:
    - "Loading states on every screen display shimmer skeleton placeholders shaped to match real content layout, not a CircularProgressIndicator spinner"
    - "Shimmer effect uses dark-themed colors consistent with the glassmorphism design (not default grey Material skeleton)"
    - "Shimmer skeletons respect Reduce Motion accessibility — animation stops when motion is disabled"
  artifacts:
    - path: "TradingBot.Mobile/pubspec.yaml"
      provides: "skeletonizer dependency"
      contains: "skeletonizer"
    - path: "TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart"
      provides: "AppShimmer wrapper widget with dark-themed shimmer effect configuration"
      contains: "AppShimmer"
    - path: "TradingBot.Mobile/lib/features/home/presentation/home_screen.dart"
      provides: "Shimmer skeleton loading state replacing CircularProgressIndicator"
      contains: "Skeletonizer"
    - path: "TradingBot.Mobile/lib/features/chart/presentation/chart_screen.dart"
      provides: "Shimmer skeleton loading state for chart screen"
      contains: "Skeletonizer"
    - path: "TradingBot.Mobile/lib/features/history/presentation/history_screen.dart"
      provides: "Shimmer skeleton loading state for history screen"
      contains: "Skeletonizer"
    - path: "TradingBot.Mobile/lib/features/config/presentation/config_screen.dart"
      provides: "Shimmer skeleton loading state for config screen"
      contains: "Skeletonizer"
    - path: "TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart"
      provides: "Shimmer skeleton loading state for portfolio screen"
      contains: "Skeletonizer"
  key_links:
    - from: "TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart"
      to: "skeletonizer package"
      via: "import package:skeletonizer"
      pattern: "package:skeletonizer"
    - from: "TradingBot.Mobile/lib/features/home/presentation/home_screen.dart"
      to: "TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart"
      via: "AppShimmer wrapper replaces CircularProgressIndicator in loading branch"
      pattern: "AppShimmer"
---

<objective>
Add the skeletonizer package and replace all CircularProgressIndicator loading states across the 5 tab screens with shimmer skeleton placeholders that match the real content layout.

Purpose: ANIM-01 requires shimmer skeletons shaped to match real content — not spinners. The skeletonizer package auto-generates skeleton shapes from the existing widget tree, guaranteeing shape fidelity. A shared AppShimmer widget configures the dark-themed shimmer colors once for consistency.

Output: skeletonizer dependency added, AppShimmer wrapper widget, 5 screens updated with shimmer loading states.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/33-design-system-foundation/33-01-SUMMARY.md
@TradingBot.Mobile/lib/features/home/presentation/home_screen.dart
@TradingBot.Mobile/lib/app/theme.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skeletonizer package and create AppShimmer wrapper widget</name>
  <files>
    TradingBot.Mobile/pubspec.yaml
    TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart
  </files>
  <action>
**Step 1: Add skeletonizer dependency.**

In `TradingBot.Mobile/pubspec.yaml`, add `skeletonizer: ^1.4.0` under `dependencies:` (after `fl_chart`). Then run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter pub get` to resolve.

**Step 2: Create AppShimmer wrapper widget.**

Create `TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart` with an `AppShimmer` StatelessWidget that:
- Takes `required bool enabled` and `required Widget child` parameters
- Wraps child in `Skeletonizer` from the skeletonizer package
- Configures dark-themed shimmer effect colors consistent with the glassmorphism design:
  - `effect: ShimmerEffect(baseColor: Color(0xFF1C2333), highlightColor: Color(0xFF2D3748), duration: Duration(seconds: 1))` — these are the opaqueSurface and opaqueBorder colors from GlassTheme, creating a cohesive dark shimmer
- Passes through `enabled` to `Skeletonizer.enabled`
- Respects Reduce Motion: when `GlassCard.shouldReduceMotion(context)` is true AND enabled is true, use `Skeletonizer` with `effect: PulseEffect(from: Color(0xFF1C2333), to: Color(0xFF2D3748))` instead of ShimmerEffect (pulse is a static fade, no lateral motion). Actually — check if Skeletonizer supports disabling animation. If it has an `enableSwitchAnimation: false` or similar, use that. Otherwise, just use `PulseEffect` as a lower-motion fallback. If neither PulseEffect nor a disable flag exists, just use ShimmerEffect regardless (the skeletonizer handles it internally).

The point of AppShimmer: all screens import `AppShimmer` instead of `Skeletonizer` directly, so the shimmer colors and motion behavior are configured in one place.

Doc comment: "App-wide shimmer skeleton wrapper. Configures dark-themed shimmer colors matching the glassmorphism design system. All screens should use this instead of Skeletonizer directly."
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter pub get && flutter analyze` — must pass with no errors. Verify pubspec.yaml has skeletonizer dependency and shimmer_loading.dart exports AppShimmer.
  </verify>
  <done>skeletonizer package installed. AppShimmer wrapper widget exists with dark-themed shimmer configuration. All shimmer colors match the glassmorphism design system.</done>
</task>

<task type="auto">
  <name>Task 2: Replace CircularProgressIndicator with shimmer skeletons on all 5 screens</name>
  <files>
    TradingBot.Mobile/lib/features/home/presentation/home_screen.dart
    TradingBot.Mobile/lib/features/chart/presentation/chart_screen.dart
    TradingBot.Mobile/lib/features/history/presentation/history_screen.dart
    TradingBot.Mobile/lib/features/config/presentation/config_screen.dart
    TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart
  </files>
  <action>
For each of the 5 tab screens, replace the `CircularProgressIndicator` loading state branch (the `AsyncLoading` or default `_` branch in the AsyncValue switch) with a shimmer skeleton that matches the screen's real content layout.

**Pattern for each screen:**

The skeletonizer approach: wrap the same widget tree that renders real data, but feed it fake/placeholder data, and wrap in `AppShimmer(enabled: true, child: ...)`. Skeletonizer automatically replaces Text, Container, and other widgets with skeleton shapes matching their size and position.

**HomeScreen** (`home_screen.dart`):
- Find the loading branch: `_ => const SliverFillRemaining(child: Center(child: CircularProgressIndicator()))`
- Replace with a `SliverPadding` + `SliverList.list` that renders the same `_buildContent` layout but with fake HomeData, wrapped in `AppShimmer(enabled: true, ...)`. Create a static `_buildSkeletonContent()` method that returns the same widget structure as `_buildContent` but with hardcoded placeholder values (e.g., `PortfolioStatsSection` with zeroed-out portfolio, `LastBuyCard` with placeholder status). Wrap the `SliverPadding` in `AppShimmer`.
- Actually, simpler approach: use `Skeletonizer` / `AppShimmer` around a `SliverToBoxAdapter` containing the placeholder widgets. The key insight: `Skeletonizer` needs a widget subtree to skeletonize. Create a helper method `_buildLoadingSkeleton()` that returns `SliverToBoxAdapter(child: AppShimmer(enabled: true, child: Padding(padding: EdgeInsets.symmetric(horizontal: 16, vertical: 8), child: Column(children: [_fakeStat(), SizedBox(height: 12), _fakeCountdown(), SizedBox(height: 16), _fakeLastBuy(), SizedBox(height: 16)]))))` where each `_fake*` method returns a Container/Card with Text placeholders that approximate the real widget sizes. Use `Bone.text()` or `Bone()` from skeletonizer if available, or just use real widgets with dummy text like `Text('Total BTC: 0.12345678')` that skeletonizer will convert to bones.
- Simplest correct approach: render `_buildContent()` with a fake `HomeData` object where all fields have placeholder values, wrap in `AppShimmer(enabled: true)`. This guarantees the skeleton matches the real layout.

**For each screen, the pattern is:**
1. Create a private `_buildLoadingSkeleton()` method or inline the skeleton in the loading branch
2. Use the same widget tree as the loaded state but with fake/default data
3. Wrap in `AppShimmer(enabled: true, child: ...)`
4. The `SliverFillRemaining(child: Center(child: CircularProgressIndicator()))` is REMOVED

**ChartScreen** (`chart_screen.dart`):
- Replace the CircularProgressIndicator loading state with a skeleton showing: timeframe selector chips + a rectangular placeholder for the chart area. Use a Column with the TimeframeSelector (it's static, doesn't need data) and a Container of approximate chart height (~300px) that skeletonizer will bone-ify.

**HistoryScreen** (`history_screen.dart`):
- Replace loading state with a skeleton showing: a list of 6-8 fake PurchaseListItem-shaped rows. Use a ListView of placeholder ListTile widgets wrapped in AppShimmer.

**ConfigScreen** (`config_screen.dart`):
- Replace loading state with a skeleton showing: 3 Card groups with placeholder text fields matching the config view layout.

**PortfolioScreen** (`portfolio_screen.dart`):
- Replace loading state with a skeleton showing: summary card + donut chart placeholder + 3-4 asset row placeholders.

**IMPORTANT implementation notes:**
- Import `AppShimmer` from `'../../../core/widgets/shimmer_loading.dart'`
- Keep the `RetryWidget` error state — only replace the loading (CircularProgressIndicator) branch
- Keep the stale-cache pattern — `AsyncError() when cachedValue != null` still shows real data
- The fake data approach works because Skeletonizer paints over Text/Container content with shimmer bones; it doesn't matter what the placeholder text says
- Use `Bone` widgets from skeletonizer package where helpful (e.g., `Bone(width: 200, height: 20)` for simple rectangular placeholders), or use real widget trees with dummy data — either approach works with Skeletonizer
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` — must pass with no errors. Verify that none of the 5 screen files contain `CircularProgressIndicator` in their loading state branches. Grep for `CircularProgressIndicator` across all 5 files — should find zero matches in loading-related code (note: it may still exist in other contexts like RefreshIndicator, which is fine).
  </verify>
  <done>All 5 tab screens (Home, Chart, History, Config, Portfolio) display shimmer skeleton placeholders during loading instead of CircularProgressIndicator spinners. Skeleton shapes match the real content layout for each screen. Dark-themed shimmer colors are consistent across all screens via AppShimmer.</done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with no errors in TradingBot.Mobile
2. `skeletonizer` package is in pubspec.yaml dependencies
3. AppShimmer widget exists in core/widgets/shimmer_loading.dart with dark-themed shimmer colors
4. All 5 screens use AppShimmer/Skeletonizer instead of CircularProgressIndicator for loading states
5. Skeleton shapes approximate the real content layout for each screen
6. Shimmer colors use glassmorphism-consistent dark tones (0xFF1C2333 base, 0xFF2D3748 highlight)
</verification>

<success_criteria>
- skeletonizer package added and resolved
- AppShimmer wrapper widget centralizes dark shimmer configuration
- All 5 tab screens show shimmer skeleton loading states matching content shape
- No CircularProgressIndicator spinners remain in loading branches
- `flutter analyze` passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-shared-glass-primitives/34-02-SUMMARY.md`
</output>
