---
phase: 36-home-screen-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/lib/app/router.dart
autonomous: true
requirements: [ANIM-05]

must_haves:
  truths:
    - "Navigating to /home/bot-detail uses a fade+scale transition instead of the default Material slide"
    - "Navigating to /portfolio/add-transaction uses a fade+scale transition"
    - "All other full-screen push routes (transaction-history, fixed-deposit detail, edit) use fade+scale transitions"
    - "Tab branch root routes (/home, /chart, /history, /config, /portfolio) use pageBuilder with CustomTransitionPage"
  artifacts:
    - path: "TradingBot.Mobile/lib/app/router.dart"
      provides: "All GoRoute entries use CustomTransitionPage with fade+scale transitions"
      contains: "CustomTransitionPage"
  key_links:
    - from: "TradingBot.Mobile/lib/app/router.dart"
      to: "FadeTransition + ScaleTransition"
      via: "transitionsBuilder in CustomTransitionPage"
      pattern: "CustomTransitionPage"
---

<objective>
Apply smooth fade+scale page transitions to all GoRouter routes, replacing the default Material slide transition with a unified 200ms fade+scale (0.95 to 1.0) effect.

Purpose: Deliver ANIM-05 (smooth page transitions for tab and modal routes), giving the app a cohesive premium feel when navigating between screens and opening full-screen modals.

Output: Updated router.dart with CustomTransitionPage on every GoRoute.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-home-screen-redesign/36-RESEARCH.md

Key file:
@TradingBot.Mobile/lib/app/router.dart (current GoRouter setup — all routes use `builder:`)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CustomTransitionPage to all GoRouter routes</name>
  <files>
    TradingBot.Mobile/lib/app/router.dart
  </files>
  <action>
    Update `router.dart` to replace every `builder:` with `pageBuilder:` using `CustomTransitionPage` for a consistent fade+scale transition.

    **Step 1: Add a reusable transition factory function** at the top of the file (after imports, before `appRouter`):

    ```dart
    /// Reusable fade+scale page transition for all routes (ANIM-05).
    CustomTransitionPage<void> fadeScalePage({
      required LocalKey key,
      required Widget child,
    }) {
      return CustomTransitionPage<void>(
        key: key,
        child: child,
        transitionDuration: const Duration(milliseconds: 200),
        reverseTransitionDuration: const Duration(milliseconds: 200),
        transitionsBuilder: (context, animation, secondaryAnimation, child) {
          return FadeTransition(
            opacity: CurvedAnimation(parent: animation, curve: Curves.easeOut),
            child: ScaleTransition(
              scale: Tween<double>(begin: 0.95, end: 1.0).animate(
                CurvedAnimation(parent: animation, curve: Curves.easeOut),
              ),
              child: child,
            ),
          );
        },
      );
    }
    ```

    **Step 2: Replace `builder:` with `pageBuilder:` on every GoRoute.** Convert each route from:
    ```dart
    GoRoute(
      path: '/home',
      builder: (context, state) => const HomeScreen(),
    ```
    To:
    ```dart
    GoRoute(
      path: '/home',
      pageBuilder: (context, state) => fadeScalePage(
        key: state.pageKey,
        child: const HomeScreen(),
      ),
    ```

    Apply this to ALL routes in the file:
    1. `/home` — `const HomeScreen()`
    2. `/home/bot-detail` — `const DcaBotDetailScreen()` (has `parentNavigatorKey: rootNavigatorKey` — keep that)
    3. `/chart` — `const ChartScreen()`
    4. `/history` — `const HistoryScreen()`
    5. `/config` — `const ConfigScreen()`
    6. `/portfolio` — `const PortfolioScreen()`
    7. `/portfolio/add-transaction` — `const AddTransactionScreen()` (has `parentNavigatorKey: rootNavigatorKey`)
    8. `/portfolio/transaction-history` — `const TransactionHistoryScreen()` (has `parentNavigatorKey: rootNavigatorKey`)
    9. `/portfolio/fixed-deposit/:id` — `FixedDepositDetailScreen(id: state.pathParameters['id']!)` (has `parentNavigatorKey: rootNavigatorKey`)
    10. `/portfolio/fixed-deposit/:id/edit` — `EditFixedDepositScreen(id: state.pathParameters['id']!)` (has `parentNavigatorKey: rootNavigatorKey`)

    **Important:** Keep all existing route properties untouched (path, parentNavigatorKey, routes children). Only change `builder:` to `pageBuilder:` and wrap the child widget in `fadeScalePage(key: state.pageKey, child: ...)`.

    **Do NOT modify:**
    - `StatefulShellRoute.indexedStack` builder (this is the navigation shell, not a page route)
    - Navigator keys
    - Route paths
    - Child route nesting structure
  </action>
  <verify>
    Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze lib/app/router.dart` — zero errors. Verify no `builder:` remains on any `GoRoute` (all should be `pageBuilder:`). Verify `fadeScalePage` function exists and is used by all 10 routes.
  </verify>
  <done>
    All 10 GoRoute entries in router.dart use `pageBuilder:` with `CustomTransitionPage` applying a 200ms fade+scale (0.95 to 1.0) transition. The `fadeScalePage` factory function provides consistency. StatefulShellRoute.indexedStack builder is unchanged. All parentNavigatorKey assignments preserved.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze lib/app/router.dart` — zero errors.
2. `router.dart` contains `CustomTransitionPage` import (from `go_router`).
3. `fadeScalePage` helper function exists with `FadeTransition` + `ScaleTransition`.
4. No `GoRoute` uses `builder:` — all use `pageBuilder:`.
5. `StatefulShellRoute.indexedStack` `builder:` is unchanged (it is not a page route).
</verification>

<success_criteria>
- Every GoRoute in router.dart uses CustomTransitionPage with fade+scale transition
- Transition duration is 200ms with Curves.easeOut
- Scale animates from 0.95 to 1.0
- StatefulShellRoute builder is not affected
- File passes flutter analyze with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/36-home-screen-redesign/36-02-SUMMARY.md`
</output>
