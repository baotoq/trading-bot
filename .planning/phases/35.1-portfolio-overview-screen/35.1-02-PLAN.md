---
phase: 35.1-portfolio-overview-screen
plan: 02
type: execute
wave: 2
depends_on: [35.1-01]
files_modified:
  - TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_asset_list_item.dart
  - TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart
autonomous: true
requirements: [PORT-UI-03]

must_haves:
  truths:
    - "Each asset row in the portfolio list renders inside a GlassCard with scrollItem variant"
    - "Asset rows show colored ticker badge, price with P&L percentage, and holding value with quantity"
    - "Loading skeleton matches the new hero + tab + asset list layout"
    - "Asset rows have PressableScale micro-interaction on tap"
    - "Scrolling the asset list maintains 60fps (no BackdropFilter in list items)"
  artifacts:
    - path: "TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_asset_list_item.dart"
      provides: "Glass-styled asset row with ticker badge, price, P&L, holding value"
      contains: "GlassVariant.scrollItem"
    - path: "TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart"
      provides: "Updated screen using new asset list item and refreshed skeleton"
      contains: "PortfolioAssetListItem"
  key_links:
    - from: "TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart"
      to: "portfolio_asset_list_item.dart"
      via: "SliverList.builder itemBuilder"
      pattern: "PortfolioAssetListItem"
    - from: "TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_asset_list_item.dart"
      to: "glass_card.dart"
      via: "GlassCard scrollItem variant"
      pattern: "GlassVariant\\.scrollItem"
    - from: "TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_asset_list_item.dart"
      to: "pressable_scale.dart"
      via: "PressableScale wrapper for tap interaction"
      pattern: "PressableScale"
---

<objective>
Replace the plain AssetRow with a glassmorphism PortfolioAssetListItem and update the loading skeleton to match the new layout.

Purpose: Completes the visual redesign of the portfolio screen by giving asset rows the glass treatment (scrollItem variant, colored ticker badge, CMC-style layout) and ensuring the loading skeleton accurately reflects the final screen structure.

Output: New portfolio_asset_list_item.dart, updated portfolio_screen.dart with new skeleton and asset list wiring.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35.1-portfolio-overview-screen/35.1-RESEARCH.md
@.planning/phases/35.1-portfolio-overview-screen/reference.png
@.planning/phases/35.1-portfolio-overview-screen/35.1-01-SUMMARY.md
@TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart
@TradingBot.Mobile/lib/features/portfolio/presentation/widgets/asset_row.dart
@TradingBot.Mobile/lib/features/portfolio/data/models/portfolio_asset_response.dart
@TradingBot.Mobile/lib/app/theme.dart
@TradingBot.Mobile/lib/core/widgets/glass_card.dart
@TradingBot.Mobile/lib/core/widgets/pressable_scale.dart
@TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PortfolioAssetListItem with glass scrollItem variant</name>
  <files>
    TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_asset_list_item.dart
  </files>
  <action>
Create `PortfolioAssetListItem` StatelessWidget matching the reference image's asset row layout:

**Parameters:**
- `PortfolioAssetResponse asset` — required
- `bool isVnd` — required
- `VoidCallback? onTap` — optional, for future navigation to asset detail

**Layout:** `PressableScale` wrapping `GlassCard`:
- GlassCard: `variant: GlassVariant.scrollItem`, `padding: EdgeInsets.symmetric(horizontal: 16, vertical: 12)`, `margin: EdgeInsets.symmetric(horizontal: 16, vertical: 4)`.
- Child is a Row with three sections:

1. **Leading: Colored ticker badge** — CircleAvatar with radius 20. backgroundColor from a deterministic color based on ticker hash (use `_tickerColor(String ticker)` that returns a color from a small palette: [bitcoinOrange, profitGreen, Color(0xFF6366F1) indigo, Color(0xFFEC4899) pink, Color(0xFF14B8A6) teal, Color(0xFF8B5CF6) purple] indexed by `ticker.hashCode % 6`). Child: Text of first 1-3 letters of ticker (use ticker itself if <= 3 chars, else first 3), white, fontWeight bold, fontSize 12.

2. **Middle column (Expanded):** Column crossAxisAlignment start:
   - Row: Text(asset.name, fontWeight w600, fontSize 14) + if asset.isPriceStale, SizedBox(width: 4) + Icon(CupertinoIcons.exclamationmark_triangle, size: 12, color: Colors.amber).
   - SizedBox(height: 2)
   - Row: Price text using `_usdFormatter.format(asset.currentPrice)` with `AppTheme.moneyStyle.copyWith(fontSize: 13, color: Colors.white70)`. Then SizedBox(width: 8). Then P&L percentage badge: if unrealizedPnlPercent != null, show Text with `'${pnl >= 0 ? '+' : ''}${pnl.toStringAsFixed(2)}%'` in `_pnlColor(pnl)` color, fontSize 12.

3. **Trailing column:** Column crossAxisAlignment end:
   - Holding value: `_formatValue(asset.currentValueUsd, asset.currentValueVnd)` with `AppTheme.moneyStyle.copyWith(fontWeight: FontWeight.w600, fontSize: 14)`.
   - SizedBox(height: 2)
   - Quantity: `'${_formatQuantity(asset)} ${asset.ticker}'` with color Colors.white54, fontSize 12.

**Helpers (private static):**
- `_vndFormatter`, `_usdFormatter` — same pattern as existing AssetRow.
- `_formatValue(double usd, double vnd)` — returns isVnd ? vnd formatted : usd formatted.
- `_formatQuantity(PortfolioAssetResponse asset)` — for ETF: `asset.quantity.toStringAsFixed(0)`, for others: `asset.quantity.toStringAsFixed(4)`. Trim trailing zeros for crypto: `asset.quantity.toStringAsFixed(4).replaceAll(RegExp(r'0+$'), '').replaceAll(RegExp(r'\.$'), '')`.
- `_pnlColor(double pnl)` — AppTheme.profitGreen if > 0, lossRed if < 0, Colors.white54 if 0.
- `_tickerColor(String ticker)` — deterministic color from palette using hashCode.

**Conventions:**
- Use `Color.withAlpha(int)` everywhere.
- Import from `../../../../core/widgets/glass_card.dart`, `../../../../core/widgets/pressable_scale.dart`, `../../../../app/theme.dart`.
- All monetary values use AppTheme.moneyStyle merge.
  </action>
  <verify>
Run `dart analyze TradingBot.Mobile` — no errors in portfolio_asset_list_item.dart.
  </verify>
  <done>
PortfolioAssetListItem renders inside a GlassCard(scrollItem) with PressableScale, showing colored ticker badge, asset name + price + P&L%, and holding value + quantity. All monetary values use tabular figures. No BackdropFilter in the widget.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire PortfolioAssetListItem into screen and update loading skeleton</name>
  <files>
    TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart
  </files>
  <action>
Two changes to portfolio_screen.dart:

**1. Replace AssetRow with PortfolioAssetListItem in _buildContent:**
- In the SliverList.builder that renders asset rows, change the itemBuilder to return `PortfolioAssetListItem(asset: sortedAssets[index], isVnd: isVnd)` instead of the old AssetRow.
- Add the import for portfolio_asset_list_item.dart.
- Remove the import for asset_row.dart from portfolio_screen.dart (the file itself stays — it may be used elsewhere, but this screen no longer needs it).

**2. Rebuild _buildLoadingSkeleton to match new layout:**
Replace the existing `_buildLoadingSkeleton()` method with a new version that matches the Plan 01 layout structure:

```
AppShimmer(
  enabled: true,
  child: Column(
    children: [
      // Hero header skeleton — GlassCard shape
      GlassCard(
        margin: EdgeInsets.all(16),
        padding: EdgeInsets.all(20),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row: [Bone.text(words: 2, fontSize: 14), Spacer, Bone(width: 60, height: 24)]
            SizedBox(height: 8),
            Bone.text(words: 1, fontSize: 28),  // Total value
            SizedBox(height: 12),
            Row: [Bone.text(words: 3, fontSize: 14)]  // P&L row
          ],
        ),
      ),
      // Tab bar skeleton
      Padding(padding: horizontal 16, vertical 8, child: Row(
        children: [
          Expanded(Bone.text(words: 1, fontSize: 14)),
          SizedBox(width: 16),
          Expanded(Bone.text(words: 1, fontSize: 14)),
        ],
      )),
      // Filter chips skeleton
      Padding(padding: horizontal 16, vertical 8, child: Row(
        children: [
          Bone(width: 100, height: 32, borderRadius: BorderRadius.circular(20)),
          SizedBox(width: 8),
          Bone(width: 120, height: 32, borderRadius: BorderRadius.circular(20)),
          SizedBox(width: 8),
          Bone(width: 80, height: 32, borderRadius: BorderRadius.circular(20)),
        ],
      )),
      // Donut chart placeholder
      Padding(padding: horizontal 16, child: Bone(width: double.infinity, height: 200, borderRadius: BorderRadius.circular(12))),
      SizedBox(height: 16),
      // Asset list item skeletons (4 rows matching new layout)
      ...List.generate(4, (_) => Padding(
        padding: EdgeInsets.symmetric(horizontal: 16, vertical: 4),
        child: GlassCard(
          variant: GlassVariant.scrollItem,
          padding: EdgeInsets.symmetric(horizontal: 16, vertical: 12),
          child: Row(
            children: [
              Bone.circle(size: 40),  // Ticker badge
              SizedBox(width: 12),
              Expanded(Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Bone.text(words: 1, fontSize: 14),
                  SizedBox(height: 4),
                  Bone.text(words: 2, fontSize: 12),
                ],
              )),
              Column(
                crossAxisAlignment: CrossAxisAlignment.end,
                children: [
                  Bone.text(words: 1, fontSize: 14),
                  SizedBox(height: 4),
                  Bone.text(words: 1, fontSize: 12),
                ],
              ),
            ],
          ),
        ),
      )),
      SizedBox(height: 80),  // FAB space
    ],
  ),
)
```

Note: The skeleton uses actual `GlassCard` widgets (scrollItem variant for list items, default for hero) so the skeleton surface matches the loaded state's glass appearance. Import `GlassCard` and `GlassVariant` if not already imported.

**3. Remove unused imports** — clean up any imports that are no longer needed (asset_type_section.dart was already removed in Plan 01 if not used, but verify). Keep the portfolio_summary_card.dart file intact (not deleted) in case other screens reference it.
  </action>
  <verify>
Run `dart analyze TradingBot.Mobile` — no errors, no unused import warnings in portfolio_screen.dart. All imports resolve correctly.
  </verify>
  <done>
Portfolio screen uses PortfolioAssetListItem for all asset rows (GlassCard scrollItem + PressableScale). Loading skeleton matches the new layout (hero header shape, tab bar, filter chips, donut placeholder, glass asset row shapes). No regressions — existing navigation and data flow preserved.
  </done>
</task>

</tasks>

<verification>
1. Run `dart analyze TradingBot.Mobile` — zero errors across all modified files
2. Visual check: Asset rows render with colored ticker badge (circle), name + price on left, holding value + quantity on right, all inside glass-styled scrollItem cards
3. Visual check: Tapping an asset row triggers PressableScale shrink + haptic feedback
4. Visual check: Loading skeleton shows hero header shape + tab bar + filter chips + donut + glass row shapes — no more spinner
5. Visual check: Scroll performance is smooth (no BackdropFilter in list items)
6. Functional check: Pull-to-refresh still works, error snackbar still shows on failures
</verification>

<success_criteria>
- PortfolioAssetListItem uses GlassCard(variant: GlassVariant.scrollItem) — no BackdropFilter in list
- Each asset row wrapped in PressableScale for tap micro-interaction
- Colored CircleAvatar ticker badge with deterministic color per ticker
- All monetary values use AppTheme.moneyStyle tabular figures
- Loading skeleton uses GlassCard surfaces matching loaded state appearance
- Skeleton has hero, tab bar, filter chips, donut, and asset row bone shapes
- All alpha values use withAlpha(int), not withOpacity(float)
</success_criteria>

<output>
After completion, create `.planning/phases/35.1-portfolio-overview-screen/35.1-02-SUMMARY.md`
</output>
