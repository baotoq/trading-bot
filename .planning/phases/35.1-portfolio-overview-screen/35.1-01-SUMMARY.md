---
phase: 35.1-portfolio-overview-screen
plan: 01
subsystem: ui
tags: [flutter, hooks_riverpod, glassmorphism, CustomScrollView, SliverPersistentHeader]

# Dependency graph
requires:
  - phase: 34-shared-glass-primitives
    provides: GlassCard (stationary/scrollItem variants), AppShimmer, PressableScale, GlassTheme tokens
  - phase: 33-glass-foundation
    provides: GlassCard, GlassVariant, AmbientBackground, AppTheme.moneyStyle
provides:
  - PortfolioHeroHeader: GlassCard stationary hero with total value + all-time P&L
  - PortfolioTabBar + StickyTabBarDelegate: 44px pinned tab switcher for Overview/Transactions
  - PortfolioFilterChips: horizontal filter row sorting asset list by holding/profit/analysis
  - Rebuilt PortfolioScreen: HookConsumerWidget with CustomScrollView sliver architecture
affects:
  - 35.1-02 (asset list glass rows will replace AssetRow in this screen)
  - 35.2-dca-bot-detail-screen (same tab/filter pattern can be reused)
  - 37 (AllocationDonutChart glow treatment deferred here, will be addressed in phase 37)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - ValueNotifier<T> from useState passed to child widgets (avoids prop drilling selectedTab/activeFilter)
    - StickyTabBarDelegate extending SliverPersistentHeaderDelegate with fixed 44px height
    - _buildContent returns List<Widget> slivers spread into CustomScrollView.slivers
    - Switch-based asset sorting from active filter chip state

key-files:
  created:
    - TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_hero_header.dart
    - TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_tab_bar.dart
    - TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_filter_chips.dart
  modified:
    - TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart

key-decisions:
  - "StickyTabBarDelegate uses fixed 44px for minExtent=maxExtent — no shrink animation needed for tab bar"
  - "Switch expression with spread cannot be used inside slivers list in Dart — _buildContent returns List<Widget> instead, spread with ... at call site"
  - "PortfolioTabBar uses ValueListenableBuilder internally for isolated rebuilds — parent only provides the ValueNotifier"
  - "PortfolioFilterChips reads GlassTheme via theme.extension<GlassTheme>() with null fallback — safe if extension not registered"

patterns-established:
  - "StickyTabBarDelegate pattern: SliverPersistentHeaderDelegate with fixed height, Material(transparent) wrapper for AmbientBackground visibility"
  - "Filter-driven sort: useState activeFilter drives sortedAssets computation in _buildContent, filter chips trigger notifier update"

requirements-completed: [PORT-UI-01, PORT-UI-02]

# Metrics
duration: 3min
completed: 2026-02-22
---

# Phase 35.1 Plan 01: Portfolio Screen Structural Shell Summary

**GlassmorphismPortfolioScreen shell with pinned tab bar, hero header (GlassCard), horizontal filter chips, and filter-driven flat asset list replacing ExpansionTile accordion layout**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-22T13:04:32Z
- **Completed:** 2026-02-22T13:07:42Z
- **Tasks:** 2
- **Files modified:** 4 (3 created, 1 rebuilt)

## Accomplishments

- Created three new widget files: PortfolioHeroHeader, PortfolioTabBar + StickyTabBarDelegate, PortfolioFilterChips — all pass dart analyze with zero issues
- Rebuilt PortfolioScreen as HookConsumerWidget with CustomScrollView sliver architecture — hero header, pinned tab bar, filter chips, donut chart, flat asset list, fixed deposits
- Filter chips now functionally sort the asset list: "Holding amount" by currentValueUsd DESC, "Cumulative profit" by unrealizedPnlUsd DESC, "Analysis" by unrealizedPnlPercent DESC (nulls last)
- Tab selection (Overview/Transactions) and active filter survive widget rebuilds via useState hooks
- All alpha operations use withAlpha(int) per project convention; all monetary values use AppTheme.moneyStyle tabular figures
- CurrencyToggle moved from SliverAppBar actions into PortfolioHeroHeader
- AmbientBackground orbs visible — Scaffold has no backgroundColor set

## Task Commits

Each task was committed atomically:

1. **Task 1: Create hero header, tab bar, and filter chips widgets** - `a91c983` (feat)
2. **Task 2: Rebuild PortfolioScreen with CustomScrollView layout** - `f0b24b5` (feat)

## Files Created/Modified

- `TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_hero_header.dart` - GlassCard stationary hero with "My Portfolio" title, CurrencyToggle, total value (headlineLarge+moneyStyle), all-time P&L colored row, StalenessLabel for VND mode
- `TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_tab_bar.dart` - PortfolioTabBar with two tab buttons + active orange bottom border indicator; StickyTabBarDelegate (44px fixed) wrapping in Material(transparent)
- `TradingBot.Mobile/lib/features/portfolio/presentation/widgets/portfolio_filter_chips.dart` - Horizontal SingleChildScrollView of three filter chips with active (bitcoinOrange) vs inactive (glass tint) states
- `TradingBot.Mobile/lib/features/portfolio/presentation/portfolio_screen.dart` - Full rebuild: HookConsumerWidget, _buildContent returns List<Widget> slivers, overview/transactions branch, filter-driven sort

## Decisions Made

- Switch expression with spread into slivers list is not valid Dart syntax — _buildContent returns `List<Widget>` of slivers and the call site spreads with `...` operator. This is cleaner than trying to embed the switch expression inline.
- PortfolioTabBar uses `ValueListenableBuilder` internally so only the tab buttons rebuild on tap, not the entire screen.
- `StickyTabBarDelegate` uses `Material(color: Colors.transparent)` so AmbientBackground orbs show through the pinned region.
- PortfolioFilterChips reads GlassTheme via `theme.extension<GlassTheme>()` with a null-safe fallback — safe if the extension is not registered in tests.

## Deviations from Plan

None - plan executed exactly as written. The switch-expression-with-spread issue was a Dart syntax constraint discovered during implementation and resolved by the List<Widget> return pattern (Rule 1 auto-fix).

### Auto-fixed Issues

**1. [Rule 1 - Bug] Switch expression spread not valid in Dart slivers list context**
- **Found during:** Task 2 (Rebuild PortfolioScreen)
- **Issue:** `..._buildContent(...)` inside a switch expression within a list literal is not valid Dart syntax — 31 errors from the analyzer
- **Fix:** Changed `_buildContent` return type to `List<Widget>` and spread it at the call site before the `contentSlivers` is built via if/else branching (not switch)
- **Files modified:** portfolio_screen.dart
- **Verification:** `dart analyze` — zero issues found
- **Committed in:** f0b24b5 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (Rule 1 - syntax bug)
**Impact on plan:** Minor structural change to how _buildContent is called. No functional change to the intended behavior.

## Issues Encountered

None beyond the auto-fixed syntax issue above.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Portfolio screen structural shell complete — Plan 02 can now replace AssetRow with glass list item rows
- PortfolioHeroHeader, PortfolioTabBar, PortfolioFilterChips are standalone widgets ready for Phase 35.1-02 to use directly
- AllocationDonutChart remains unchanged — glow treatment deferred to Phase 37 per research recommendation
- AssetTypeSection (ExpansionTile) is no longer used by PortfolioScreen — can be deprecated when Plan 02 confirms it is not used elsewhere

---
*Phase: 35.1-portfolio-overview-screen*
*Completed: 2026-02-22*
