---
phase: 20-flutter-project-setup-core-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/pubspec.yaml
  - TradingBot.Mobile/analysis_options.yaml
  - TradingBot.Mobile/lib/main.dart
  - TradingBot.Mobile/lib/app/router.dart
  - TradingBot.Mobile/lib/app/theme.dart
  - TradingBot.Mobile/lib/shared/navigation_shell.dart
  - TradingBot.Mobile/lib/features/home/presentation/home_screen.dart
  - TradingBot.Mobile/lib/features/chart/presentation/chart_screen.dart
  - TradingBot.Mobile/lib/features/history/presentation/history_screen.dart
  - TradingBot.Mobile/lib/features/config/presentation/config_screen.dart
autonomous: true
requirements:
  - APP-04
  - APP-05

must_haves:
  truths:
    - "App launches directly to the Home tab with dark theme applied"
    - "Bottom navigation bar shows 4 tabs (Home, Chart, History, Config) with Cupertino-style icons and text labels"
    - "Switching tabs preserves each tab's state (IndexedStack behavior)"
    - "Each tab screen has a pull-to-refresh scaffold (RefreshIndicator wrapping a ListView)"
    - "App uses dark-only theme with Bitcoin orange (#F7931A) accent color"
  artifacts:
    - path: "TradingBot.Mobile/pubspec.yaml"
      provides: "All core dependencies declared"
      contains: "go_router"
    - path: "TradingBot.Mobile/lib/main.dart"
      provides: "ProviderScope + MaterialApp.router entry point"
      contains: "ProviderScope"
    - path: "TradingBot.Mobile/lib/app/router.dart"
      provides: "GoRouter with StatefulShellRoute.indexedStack and 4 branches"
      contains: "StatefulShellRoute.indexedStack"
    - path: "TradingBot.Mobile/lib/app/theme.dart"
      provides: "Dark-only ThemeData with Bitcoin orange seed"
      contains: "bitcoinOrange"
    - path: "TradingBot.Mobile/lib/shared/navigation_shell.dart"
      provides: "Scaffold with NavigationBar + CupertinoIcons"
      contains: "NavigationBar"
  key_links:
    - from: "TradingBot.Mobile/lib/main.dart"
      to: "TradingBot.Mobile/lib/app/router.dart"
      via: "routerConfig: appRouter"
      pattern: "routerConfig.*appRouter"
    - from: "TradingBot.Mobile/lib/main.dart"
      to: "TradingBot.Mobile/lib/app/theme.dart"
      via: "theme: AppTheme.dark"
      pattern: "AppTheme\\.dark"
    - from: "TradingBot.Mobile/lib/app/router.dart"
      to: "TradingBot.Mobile/lib/shared/navigation_shell.dart"
      via: "builder passes navigationShell to ScaffoldWithNavigation"
      pattern: "ScaffoldWithNavigation"
---

<objective>
Scaffold the Flutter iOS project with all dependencies, dark-only Material 3 theme with Bitcoin orange accent, go_router navigation with 4-tab bottom bar, and placeholder feature screens with pull-to-refresh scaffolding.

Purpose: Establishes the foundational project structure, navigation, and theming that all subsequent phases build upon. After this plan, the app launches to a dark-themed Home tab with functional tab navigation.

Output: Working Flutter app with 4-tab navigation, dark theme, pull-to-refresh scaffolding on all screens.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-flutter-project-setup-core-infrastructure/20-RESEARCH.md
@.planning/phases/20-flutter-project-setup-core-infrastructure/20-CONTEXT.md
@TradingBot.Mobile/pubspec.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure project dependencies, structure, and dark theme</name>
  <files>
    TradingBot.Mobile/pubspec.yaml
    TradingBot.Mobile/analysis_options.yaml
    TradingBot.Mobile/lib/app/theme.dart
  </files>
  <action>
    **1. Update `pubspec.yaml`** — replace the entire file with production config:
    - name: `trading_bot_app`
    - description: `BTC Smart DCA Bot mobile dashboard`
    - publish_to: `'none'`
    - version: `1.0.0+1`
    - environment sdk: `^3.7.0`
    - Dependencies: `flutter` (sdk), `cupertino_icons: ^1.0.8`, `go_router: ^17.1.0`, `hooks_riverpod: ^3.2.1`, `flutter_hooks: any`, `riverpod_annotation: ^4.0.2`, `dio: ^5.9.1`
    - Dev dependencies: `flutter_test` (sdk), `flutter_lints: ^5.0.0`, `build_runner: any`, `riverpod_generator: ^4.0.3`, `riverpod_lint: any`, `custom_lint: any`
    - flutter section: `uses-material-design: true`
    - Remove all boilerplate comments

    **2. Update `analysis_options.yaml`** to enable custom_lint:
    ```yaml
    include: package:flutter_lints/flutter.yaml
    analyzer:
      plugins:
        - custom_lint
    ```

    **3. Create `lib/app/theme.dart`** — Dark-only Material 3 theme:
    - `AppTheme` class with static color constants:
      - `bitcoinOrange = Color(0xFFF7931A)` — primary accent
      - `profitGreen = Color(0xFF00C087)` — P&L positive
      - `lossRed = Color(0xFFFF4D4D)` — P&L negative
      - `surfaceDark = Color(0xFF121212)` — scaffold background
      - `navBarDark = Color(0xFF1A1A1A)` — navigation bar background
    - `static ThemeData get dark` using:
      - `useMaterial3: true`
      - `colorScheme: ColorScheme.fromSeed(seedColor: bitcoinOrange, brightness: Brightness.dark)`
      - `brightness: Brightness.dark`
      - `scaffoldBackgroundColor: surfaceDark`
      - `navigationBarTheme: NavigationBarThemeData(backgroundColor: navBarDark, indicatorColor: bitcoinOrange.withAlpha(51))` (20% opacity)
      - `snackBarTheme: SnackBarThemeData(behavior: SnackBarBehavior.floating)` — floating snackbars globally
    - NO `darkTheme`, NO `themeMode` — dark-only per locked decision

    **4. Run `flutter pub get`** in TradingBot.Mobile to install dependencies.

    **5. Delete leftover platform directories** that were created by default `flutter create` but are not needed (iOS-only per decision):
    - Delete `android/`, `linux/`, `macos/`, `web/`, `windows/` directories
    - Keep only `ios/` directory
    - Delete `test/widget_test.dart` (default counter test, will be replaced later)
  </action>
  <verify>
    Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter pub get` — exits 0, no dependency resolution errors.
    Verify `ls lib/app/theme.dart` exists.
    Verify only `ios/` platform directory remains: `ls -d android linux macos web windows 2>/dev/null` returns nothing.
  </verify>
  <done>
    pubspec.yaml has all 7 runtime dependencies and 5 dev dependencies. analysis_options.yaml includes custom_lint. AppTheme.dark produces a dark Material 3 ThemeData with Bitcoin orange seed. Non-iOS platform directories removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create go_router with 4-tab StatefulShellRoute and navigation shell</name>
  <files>
    TradingBot.Mobile/lib/app/router.dart
    TradingBot.Mobile/lib/shared/navigation_shell.dart
    TradingBot.Mobile/lib/main.dart
  </files>
  <action>
    **1. Create `lib/app/router.dart`** — GoRouter with StatefulShellRoute.indexedStack:
    - Declare 5 GlobalKey<NavigatorState>: `_rootNavigatorKey`, `_homeNavKey`, `_chartNavKey`, `_historyNavKey`, `_configNavKey` (each with debugLabel)
    - Create `final GoRouter appRouter = GoRouter(...)`:
      - `navigatorKey: _rootNavigatorKey`
      - `initialLocation: '/home'`
      - Single `StatefulShellRoute.indexedStack` route with:
        - `builder: (context, state, navigationShell) => ScaffoldWithNavigation(navigationShell: navigationShell)`
        - 4 `StatefulShellBranch` entries:
          - Branch 0: `navigatorKey: _homeNavKey`, route `/home` -> `HomeScreen()`
          - Branch 1: `navigatorKey: _chartNavKey`, route `/chart` -> `ChartScreen()`
          - Branch 2: `navigatorKey: _historyNavKey`, route `/history` -> `HistoryScreen()`
          - Branch 3: `navigatorKey: _configNavKey`, route `/config` -> `ConfigScreen()`

    **2. Create `lib/shared/navigation_shell.dart`** — ScaffoldWithNavigation widget:
    - `StatelessWidget` taking `StatefulNavigationShell navigationShell` as required constructor parameter
    - Private `_goBranch(int index)` method calling `navigationShell.goBranch(index, initialLocation: index == navigationShell.currentIndex)` — tapping active tab pops to root
    - Build returns `Scaffold(body: navigationShell, bottomNavigationBar: NavigationBar(...))`:
      - `selectedIndex: navigationShell.currentIndex`
      - `onDestinationSelected: _goBranch`
      - 4 `NavigationDestination` entries with CupertinoIcons:
        - Home: icon `CupertinoIcons.house`, selectedIcon `CupertinoIcons.house_fill`, label `'Home'`
        - Chart: icon `CupertinoIcons.chart_bar`, selectedIcon `CupertinoIcons.chart_bar_fill`, label `'Chart'`
        - History: icon `CupertinoIcons.clock`, selectedIcon `CupertinoIcons.clock_fill`, label `'History'`
        - Config: icon `CupertinoIcons.settings`, selectedIcon `CupertinoIcons.settings_solid`, label `'Config'`
    - Do NOT use CupertinoTabBar or CupertinoTabScaffold — known crash bug with StatefulShellRoute

    **3. Replace `lib/main.dart`** entirely:
    ```dart
    import 'package:flutter/material.dart';
    import 'package:hooks_riverpod/hooks_riverpod.dart';
    import 'app/router.dart';
    import 'app/theme.dart';

    void main() {
      runApp(const ProviderScope(child: TradingBotApp()));
    }

    class TradingBotApp extends StatelessWidget {
      const TradingBotApp({super.key});

      @override
      Widget build(BuildContext context) {
        return MaterialApp.router(
          title: 'Trading Bot',
          theme: AppTheme.dark,
          routerConfig: appRouter,
          debugShowCheckedModeBanner: false,
        );
      }
    }
    ```
    - NO darkTheme, NO themeMode — dark-only per locked decision
    - ProviderScope wraps entire app for Riverpod state management
  </action>
  <verify>
    Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && dart analyze lib/main.dart lib/app/router.dart lib/shared/navigation_shell.dart` — no errors (warnings about unused imports are acceptable if feature screens not yet created).
  </verify>
  <done>
    GoRouter configured with 4-tab StatefulShellRoute.indexedStack. NavigationBar uses CupertinoIcons with text labels. main.dart uses ProviderScope + MaterialApp.router with dark-only theme. App starts at /home tab.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create 4 placeholder feature screens with pull-to-refresh scaffold</name>
  <files>
    TradingBot.Mobile/lib/features/home/presentation/home_screen.dart
    TradingBot.Mobile/lib/features/chart/presentation/chart_screen.dart
    TradingBot.Mobile/lib/features/history/presentation/history_screen.dart
    TradingBot.Mobile/lib/features/config/presentation/config_screen.dart
  </files>
  <action>
    Create 4 placeholder screens, each following this pattern:
    - Import `package:flutter/material.dart` and `package:hooks_riverpod/hooks_riverpod.dart`
    - Extend `ConsumerWidget` (not StatelessWidget — Riverpod-aware for later provider integration)
    - Build method returns a `RefreshIndicator` wrapping a `CustomScrollView` with `SliverFillRemaining`:
      ```dart
      RefreshIndicator(
        onRefresh: () async {
          // TODO: Wire to provider refresh in future phases
        },
        child: CustomScrollView(
          slivers: [
            SliverFillRemaining(
              child: Center(
                child: Text(
                  '{Tab Name}',
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
              ),
            ),
          ],
        ),
      )
      ```
    - This structure ensures pull-to-refresh works (RefreshIndicator requires scrollable child) while showing a centered label
    - The `onRefresh` callback is a placeholder `async {}` — Plan 20-02 and Phase 21+ will wire real providers

    Create these 4 files:
    1. `lib/features/home/presentation/home_screen.dart` — class `HomeScreen`, displays "Home"
    2. `lib/features/chart/presentation/chart_screen.dart` — class `ChartScreen`, displays "Chart"
    3. `lib/features/history/presentation/history_screen.dart` — class `HistoryScreen`, displays "History"
    4. `lib/features/config/presentation/config_screen.dart` — class `ConfigScreen`, displays "Config"

    After creating all files, run `dart run build_runner build --delete-conflicting-outputs` from the TradingBot.Mobile directory to initialize Riverpod code generation (even though no @riverpod annotations exist yet, this validates the build_runner setup).
  </action>
  <verify>
    Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && dart analyze` — no errors across entire lib/ directory.
    All 4 screen files exist: `ls lib/features/*/presentation/*_screen.dart` returns 4 files.
    Build runner exits 0: `dart run build_runner build --delete-conflicting-outputs` succeeds.
  </verify>
  <done>
    4 placeholder screens exist as ConsumerWidgets with RefreshIndicator scaffolding. Pull-to-refresh gesture works on each tab (though onRefresh is a no-op placeholder). dart analyze passes with zero errors. build_runner completes successfully.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter pub get` — exits 0
2. `dart analyze` — no errors
3. `dart run build_runner build --delete-conflicting-outputs` — exits 0
4. Verify file structure: `find lib -name '*.dart' | sort` shows main.dart, app/router.dart, app/theme.dart, shared/navigation_shell.dart, and 4 feature screen files
5. Verify no non-iOS platform dirs: `ls -d android linux macos web windows 2>/dev/null` returns nothing
</verification>

<success_criteria>
- App would launch to dark-themed Home tab (verifiable by `flutter build ios --no-codesign` succeeding)
- Bottom navigation bar visible with 4 tabs using Cupertino icons
- Tab switching preserves state (StatefulShellRoute.indexedStack)
- Each screen has pull-to-refresh gesture (RefreshIndicator wrapping scrollable)
- Dark-only theme with Bitcoin orange accent applied globally
- All dependencies installed, build_runner functional
</success_criteria>

<output>
After completion, create `.planning/phases/20-flutter-project-setup-core-infrastructure/20-01-SUMMARY.md`
</output>
