---
phase: 09-infrastructure-aspire-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/package.json
  - dashboard/nuxt.config.ts
  - dashboard/app/app.vue
  - dashboard/assets/css/main.css
  - dashboard/tsconfig.json
  - dashboard/server/api/health.get.ts
  - TradingBot.AppHost/AppHost.cs
  - TradingBot.AppHost/TradingBot.AppHost.csproj
autonomous: true

must_haves:
  truths:
    - "Nuxt dev server starts and serves a page at localhost:3000"
    - "Aspire orchestrates Nuxt alongside .NET API as visible services"
    - "Aspire dashboard shows both apiservice and dashboard resources"
    - "Nuxt project uses Nuxt 4, TypeScript, Tailwind CSS v4, and Nuxt UI"
  artifacts:
    - path: "dashboard/package.json"
      provides: "Nuxt 4 project with dev script for Aspire"
      contains: "nuxt dev"
    - path: "dashboard/nuxt.config.ts"
      provides: "Nuxt configuration with modules and TypeScript"
      contains: "@nuxt/ui"
    - path: "dashboard/app/app.vue"
      provides: "Root Vue component with UApp wrapper"
      contains: "UApp"
    - path: "dashboard/assets/css/main.css"
      provides: "Tailwind CSS + Nuxt UI imports"
      contains: "tailwindcss"
    - path: "dashboard/server/api/health.get.ts"
      provides: "Health endpoint for Aspire monitoring"
      contains: "healthy"
    - path: "TradingBot.AppHost/AppHost.cs"
      provides: "Aspire orchestration including Nuxt dashboard"
      contains: "AddNpmApp"
    - path: "TradingBot.AppHost/TradingBot.AppHost.csproj"
      provides: "Aspire.Hosting.JavaScript NuGet reference"
      contains: "Aspire.Hosting.JavaScript"
  key_links:
    - from: "TradingBot.AppHost/AppHost.cs"
      to: "dashboard/"
      via: "AddNpmApp with relative path"
      pattern: 'AddNpmApp\("dashboard", "\.\./dashboard", "dev"\)'
    - from: "TradingBot.AppHost/AppHost.cs"
      to: "apiservice"
      via: "WaitFor dependency"
      pattern: "WaitFor\\(apiService\\)"
---

<objective>
Create Nuxt 4 frontend project and integrate it into Aspire orchestration so both the .NET API and Nuxt dev server run as managed services.

Purpose: Establishes the frontend foundation (INFR-01) and Aspire orchestration (INFR-02) that all subsequent dashboard phases build on.
Output: A working Nuxt 4 project visible in the Aspire dashboard alongside the .NET API service.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-infrastructure-aspire-integration/09-RESEARCH.md
@TradingBot.AppHost/AppHost.cs
@TradingBot.AppHost/TradingBot.AppHost.csproj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Nuxt 4 project with Nuxt UI and Tailwind CSS v4</name>
  <files>
    dashboard/package.json
    dashboard/nuxt.config.ts
    dashboard/app/app.vue
    dashboard/assets/css/main.css
    dashboard/tsconfig.json
    dashboard/server/api/health.get.ts
    dashboard/.gitignore
  </files>
  <action>
Create the Nuxt 4 frontend project in `dashboard/` at the repository root (sibling to TradingBot.AppHost/).

1. Run `npx nuxi@latest init dashboard` from the repo root to scaffold Nuxt 4 project. If nuxi prompts for options, accept defaults.

2. Install dependencies:
   ```bash
   cd dashboard && npm install @nuxt/ui tailwindcss
   ```

3. Configure `dashboard/nuxt.config.ts`:
   ```typescript
   export default defineNuxtConfig({
     modules: ['@nuxt/ui'],

     css: ['~/assets/css/main.css'],

     devtools: { enabled: true },

     typescript: {
       strict: true,
       typeCheck: false
     },

     compatibilityDate: '2024-11-01'
   })
   ```
   Note: Do NOT add routeRules or runtimeConfig yet -- that is Plan 09-02.

4. Create `dashboard/assets/css/main.css`:
   ```css
   @import "tailwindcss";
   @import "@nuxt/ui";
   ```

5. Create `dashboard/app/app.vue`:
   ```vue
   <template>
     <UApp>
       <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
         <div class="flex items-center justify-center min-h-screen">
           <div class="text-center">
             <h1 class="text-4xl font-bold text-gray-900 dark:text-white">
               BTC Smart DCA Dashboard
             </h1>
             <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
               Dashboard is running
             </p>
           </div>
         </div>
       </div>
     </UApp>
   </template>
   ```

6. Create health endpoint at `dashboard/server/api/health.get.ts`:
   ```typescript
   export default defineEventHandler(() => {
     return { status: 'healthy', timestamp: new Date().toISOString() }
   })
   ```

7. Ensure `dashboard/package.json` has the `dev` script pointing to `nuxt dev` (should be created by nuxi init). Verify `"type": "module"` and `"private": true` are present.

8. Add `dashboard/.gitignore` if not already created by nuxi:
   ```
   node_modules/
   .nuxt/
   .output/
   dist/
   .env
   ```

9. Run `npm run build --prefix dashboard` to verify the project compiles (or `cd dashboard && npx nuxi prepare` to generate types).
  </action>
  <verify>
    Run `cd /Users/baotoq/Work/trading-bot/dashboard && npx nuxi prepare` -- should complete without errors.
    Verify `dashboard/package.json` exists and contains `"dev": "nuxt dev"` script.
    Verify `dashboard/nuxt.config.ts` includes `@nuxt/ui` module.
    Verify `dashboard/server/api/health.get.ts` exists.
  </verify>
  <done>
    Nuxt 4 project exists in `dashboard/` with Nuxt UI module, Tailwind CSS v4, TypeScript strict mode, a root app.vue with UApp wrapper, and a health endpoint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate Nuxt dashboard into Aspire AppHost</name>
  <files>
    TradingBot.AppHost/TradingBot.AppHost.csproj
    TradingBot.AppHost/AppHost.cs
  </files>
  <action>
Add Aspire.Hosting.JavaScript package and configure the Nuxt dev server in AppHost.

1. Add the NuGet package:
   ```bash
   dotnet add TradingBot.AppHost package Aspire.Hosting.JavaScript --version 13.0.1
   ```

2. Modify `TradingBot.AppHost/AppHost.cs` -- add the dashboard resource AFTER the `apiService` variable and BEFORE `builder.Build().Run()`. Do NOT replace the existing code; ADD to it:

   ```csharp
   // Dashboard (Nuxt 4)
   var dashboard = builder.AddNpmApp("dashboard", "../dashboard", "dev")
       .WithHttpEndpoint(port: 3000, env: "PORT")
       .WithExternalHttpEndpoints()
       .WithReference(apiService)
       .WaitFor(apiService);
   ```

   Key points:
   - `AddNpmApp("dashboard", "../dashboard", "dev")` runs `npm run dev` in the `../dashboard` directory relative to AppHost
   - `WithHttpEndpoint(port: 3000, env: "PORT")` allocates port 3000 and sets PORT env var for Nuxt
   - `WithExternalHttpEndpoints()` makes the endpoint accessible from browser (not just service-to-service)
   - `WithReference(apiService)` enables service discovery
   - `WaitFor(apiService)` ensures API starts before dashboard
   - Do NOT add `WithHttpHealthCheck` yet -- Nuxt dev server health check is unreliable during HMR. Aspire will track process health automatically.

3. Verify the AppHost builds:
   ```bash
   dotnet build TradingBot.AppHost
   ```
  </action>
  <verify>
    Run `dotnet build /Users/baotoq/Work/trading-bot/TradingBot.AppHost` -- should compile without errors.
    Grep `AppHost.cs` for `AddNpmApp` -- should find the dashboard resource.
    Grep `TradingBot.AppHost.csproj` for `Aspire.Hosting.JavaScript` -- should find the package reference.
  </verify>
  <done>
    Aspire AppHost includes `Aspire.Hosting.JavaScript` package and configures Nuxt dashboard via `AddNpmApp` with port 3000, service reference to apiService, and startup ordering via WaitFor.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build TradingBot.AppHost` compiles successfully
2. `dashboard/package.json` exists with Nuxt 4 and Nuxt UI dependencies
3. `dashboard/nuxt.config.ts` includes `@nuxt/ui` module
4. `dashboard/app/app.vue` contains `<UApp>` wrapper
5. `dashboard/server/api/health.get.ts` returns healthy status
6. `TradingBot.AppHost/AppHost.cs` contains `AddNpmApp("dashboard"...)` with `WaitFor(apiService)`
7. `TradingBot.AppHost/TradingBot.AppHost.csproj` references `Aspire.Hosting.JavaScript`
</verification>

<success_criteria>
- Nuxt 4 project scaffolded with TypeScript, Tailwind CSS v4, Nuxt UI
- Aspire AppHost builds and includes dashboard as managed service
- Dashboard waits for API service to start before launching
- Health endpoint exists at /api/health for future Aspire health checks
</success_criteria>

<output>
After completion, create `.planning/phases/09-infrastructure-aspire-integration/09-01-SUMMARY.md`
</output>
