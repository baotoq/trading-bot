---
phase: 33-design-system-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/lib/app/theme.dart
  - TradingBot.Mobile/lib/core/widgets/ambient_background.dart
  - TradingBot.Mobile/lib/shared/navigation_shell.dart
autonomous: true
requirements:
  - DESIGN-02
  - DESIGN-03
  - DESIGN-04

must_haves:
  truths:
    - "All glass design tokens (blur sigma, tint opacity, border color/width, glow color, card radius, opaque fallbacks) are defined in a single GlassTheme ThemeExtension and accessible via Theme.of(context).extension<GlassTheme>()!"
    - "App scaffold background is dark navy (#0D1117) with 2-3 static radial gradient orbs visible behind all screens"
    - "All monetary values display with tabular figures (FontFeature.tabularFigures) so digits align vertically in lists"
  artifacts:
    - path: "TradingBot.Mobile/lib/app/theme.dart"
      provides: "GlassTheme ThemeExtension class with all design tokens, registered in ThemeData.extensions, plus moneyStyle TextStyle with tabular figures"
      contains: "class GlassTheme extends ThemeExtension<GlassTheme>"
    - path: "TradingBot.Mobile/lib/core/widgets/ambient_background.dart"
      provides: "AmbientBackground widget with dark navy base and 2-3 static radial gradient orbs at 10-15% opacity"
      contains: "class AmbientBackground"
    - path: "TradingBot.Mobile/lib/shared/navigation_shell.dart"
      provides: "Navigation shell wrapping body in AmbientBackground with transparent scaffold"
      contains: "AmbientBackground"
  key_links:
    - from: "TradingBot.Mobile/lib/app/theme.dart"
      to: "ThemeData.extensions"
      via: "GlassTheme instance registered in extensions list"
      pattern: "extensions.*GlassTheme"
    - from: "TradingBot.Mobile/lib/shared/navigation_shell.dart"
      to: "TradingBot.Mobile/lib/core/widgets/ambient_background.dart"
      via: "AmbientBackground wrapping navigationShell body"
      pattern: "AmbientBackground"
---

<objective>
Create the design token layer (GlassTheme ThemeExtension), ambient gradient background, and typography scale as the foundation for the glassmorphism UI.

Purpose: Every subsequent phase (34-38) needs a single source of truth for glass/blur/border/glow tokens, a shared ambient background behind all screens, and tabular figure typography for monetary values. This plan establishes all three.

Output: GlassTheme ThemeExtension registered in ThemeData, AmbientBackground widget with static orbs, navigation shell integration, and moneyStyle TextStyle.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-design-system-foundation/33-CONTEXT.md
@.planning/phases/33-design-system-foundation/33-RESEARCH.md
@TradingBot.Mobile/lib/app/theme.dart
@TradingBot.Mobile/lib/shared/navigation_shell.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GlassTheme ThemeExtension and update theme.dart with design tokens + typography</name>
  <files>TradingBot.Mobile/lib/app/theme.dart</files>
  <action>
In `theme.dart`, add the `GlassTheme` ThemeExtension class and register it in the existing `AppTheme.dark` ThemeData. Also add typography constants for monetary values.

**GlassTheme class** (add above AppTheme class):
- Import `dart:ui` for `FontFeature`, `ImageFilter`, `lerpDouble`
- Create `class GlassTheme extends ThemeExtension<GlassTheme>` with these fields:
  - `double blurSigma` = 12.0 (moderate for cards per STATE.md)
  - `double tintOpacity` = 0.08 (subtle dark tint on navy background)
  - `Color tintColor` = Colors.white
  - `Color borderColor` = Colors.white.withAlpha(31) (~0.12 opacity)
  - `double borderWidth` = 1.0
  - `Color glowColor` = Color(0xFFF7931A).withAlpha(15) (~0.06 opacity, subtle BTC orange glow)
  - `double cardRadius` = 16.0
  - `Color opaqueSurface` = Color(0xFF1C2333) (navy lifted ~10 lightness for Reduce Transparency fallback)
  - `Color opaqueBorder` = Color(0xFF2D3748)
- Implement `copyWith()` with all nullable optional parameters
- Implement `lerp()` using `lerpDouble` and `Color.lerp` for all fields
- Add a `const` constructor

**AppTheme changes:**
- Add `static const Color navyBackground = Color(0xFF0D1117)` (per locked decision)
- Keep `bitcoinOrange`, `profitGreen`, `lossRed` unchanged (STATE.md: non-negotiable semantic constants)
- Change `scaffoldBackgroundColor` from `surfaceDark` to `Colors.transparent` (AmbientBackground provides the actual background)
- Add GlassTheme instance to `ThemeData.extensions` list in the `dark` getter
- Add a static `moneyStyle` TextStyle constant with `fontFeatures: [FontFeature.tabularFigures()]` for monetary values — this is just the feature flag, not a complete style (consumers merge via copyWith)

**Why transparent scaffold:** The AmbientBackground widget (Task 2) provides the navy base color and orbs. If Scaffold has its own background color, it paints over the orbs. Individual screens' Scaffolds inherit the transparent background from the global theme.

**Note:** Keep `surfaceDark` and `navBarDark` constants — they may still be used by existing widgets until screens are restyled in later phases.
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` — no errors or warnings in theme.dart. Verify the GlassTheme class compiles with all required ThemeExtension overrides (copyWith, lerp).
  </verify>
  <done>
GlassTheme ThemeExtension class exists in theme.dart with all 9 design tokens, copyWith, and lerp. It is registered in ThemeData.extensions. scaffoldBackgroundColor is Colors.transparent. navyBackground constant is defined. moneyStyle TextStyle with FontFeature.tabularFigures() exists as a static constant on AppTheme.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AmbientBackground widget and integrate into navigation shell</name>
  <files>TradingBot.Mobile/lib/core/widgets/ambient_background.dart, TradingBot.Mobile/lib/shared/navigation_shell.dart</files>
  <action>
**Create `ambient_background.dart`** in `lib/core/widgets/`:

Create `class AmbientBackground extends StatelessWidget` with a required `Widget child` parameter:

Build method returns a `Stack` with:
1. Base layer: `ColoredBox` with `AppTheme.navyBackground` (Color(0xFF0D1117)) filling the entire screen via `SizedBox.expand()`
2. Orb 1 (top-left): `Positioned(top: -80, left: -60)` with a 320px circular Container using `RadialGradient` — warm amber `Color(0xFFF7931A).withAlpha(28)` (~0.11 opacity) fading to transparent. This resonates with the BTC orange brand.
3. Orb 2 (bottom-right): `Positioned(bottom: -100, right: -80)` with a 360px circular Container using `RadialGradient` — cool indigo `Color(0xFF4F46E5).withAlpha(26)` (~0.10 opacity) fading to transparent. Provides depth contrast.
4. Orb 3 (center-left): `Positioned(top: 240, left: -120)` with a 280px circular Container using `RadialGradient` — muted teal `Color(0xFF0D9488).withAlpha(20)` (~0.08 opacity) fading to transparent. Mid-screen warmth.
5. The `child` widget on top.

Extract `_buildOrb({required double size, required Color color})` as a private helper returning the circular Container with RadialGradient decoration.

Import `AppTheme` from `package:trading_bot/app/theme.dart`.

**Orb design notes per CONTEXT.md:**
- Orbs are very subtle at 10-15% opacity — barely-visible color pools, not prominent visual elements
- Colors complement dark navy base and existing orange brand
- Static only — no animation (Out of Scope: animated gradient background)

**Update `navigation_shell.dart`:**

Import `AmbientBackground` and wrap the Scaffold body:
- Change the `Scaffold` to have `backgroundColor: Colors.transparent` (so the transparent theme works here)
- Wrap `navigationShell` with `AmbientBackground`: the Scaffold's `body` becomes `AmbientBackground(child: navigationShell)`

This ensures the ambient background renders behind ALL tab content, not per-screen. The orbs don't rebuild on tab switch because they're above the individual screen scaffolds.

**Why AmbientBackground wraps body, not the entire Scaffold:** The NavigationBar needs to sit below the content. If AmbientBackground wrapped the entire Scaffold, orbs would render behind the nav bar too (which is fine visually since the nav bar has its own backgroundColor). However, wrapping the body is cleaner because:
- The nav bar has its own `navBarDark` background
- Orbs are meant to appear behind content, not behind chrome

**Pitfall from research:** If AmbientBackground is placed inside individual screen Scaffolds, each tab rebuild recreates the orbs, and the background resets on navigation. Placing it in the navigation shell avoids this.
  </action>
  <verify>
Run `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` — no errors. Verify `ambient_background.dart` exists and `navigation_shell.dart` imports and uses it.
  </verify>
  <done>
AmbientBackground widget exists at `lib/core/widgets/ambient_background.dart` with dark navy base and 3 static radial gradient orbs at 10-15% opacity. ScaffoldWithNavigation wraps its body with AmbientBackground and has transparent scaffold background. All screens share the same ambient background without per-screen recreation.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/baotoq/Work/trading-bot/TradingBot.Mobile && flutter analyze` passes with no errors
2. `theme.dart` contains `class GlassTheme extends ThemeExtension<GlassTheme>` with 9 token fields
3. `theme.dart` registers GlassTheme in `ThemeData.extensions`
4. `theme.dart` has `scaffoldBackgroundColor: Colors.transparent`
5. `theme.dart` has `navyBackground` constant with value `Color(0xFF0D1117)`
6. `theme.dart` has `moneyStyle` TextStyle with `FontFeature.tabularFigures()`
7. `ambient_background.dart` exists with 3 orb Positioned widgets inside a Stack
8. `navigation_shell.dart` wraps body with `AmbientBackground`
9. `navigation_shell.dart` Scaffold has `backgroundColor: Colors.transparent`
</verification>

<success_criteria>
- GlassTheme ThemeExtension is the single source of truth for all glass design tokens
- Any widget can access tokens via `Theme.of(context).extension<GlassTheme>()!`
- Ambient background with dark navy + 3 subtle orbs is visible behind all tab screens
- Monetary values can use `AppTheme.moneyStyle` to enable tabular figure alignment
- No new packages required — all built with Flutter SDK
</success_criteria>

<output>
After completion, create `.planning/phases/33-design-system-foundation/33-01-SUMMARY.md`
</output>
