---
phase: 31-milestone-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/26-portfolio-domain-foundation/26-VERIFICATION.md
  - .planning/phases/27-price-feed-infrastructure/27-VERIFICATION.md
  - .planning/phases/28-portfolio-backend-api/28-VERIFICATION.md
  - .planning/phases/29-flutter-portfolio-ui/29-VERIFICATION.md
  - .planning/phases/27-price-feed-infrastructure/27-01-SUMMARY.md
  - .planning/phases/27-price-feed-infrastructure/27-02-SUMMARY.md
  - .planning/phases/28-portfolio-backend-api/28-01-SUMMARY.md
  - .planning/phases/28-portfolio-backend-api/28-02-SUMMARY.md
  - .planning/REQUIREMENTS.md
autonomous: true
requirements:
  - PORT-01
  - PORT-02
  - PORT-03
  - PORT-04
  - PORT-05
  - PORT-06
  - PRICE-01
  - PRICE-02
  - PRICE-03
  - PRICE-04
  - DISP-01
  - DISP-02
  - DISP-03
  - DISP-04
  - DISP-05
  - DISP-06
  - DISP-07
  - DISP-08
  - DISP-09
  - DISP-10

must_haves:
  truths:
    - "VERIFICATION.md exists for each of phases 26, 27, 28, 29, and 30 with per-requirement pass/fail status"
    - "Every SUMMARY.md across phases 26-30 has a requirements-completed frontmatter field listing its satisfied requirement IDs"
    - "REQUIREMENTS.md traceability table shows all 20 v4.0 requirements as [x] with correct phase assignments"
    - "No requirement ID is orphaned — every ID appears in at least one VERIFICATION.md and at least one SUMMARY.md"
  artifacts:
    - path: ".planning/phases/26-portfolio-domain-foundation/26-VERIFICATION.md"
      provides: "Verification report for Phase 26"
      contains: "PORT-01, PORT-02, PORT-03, PORT-06"
    - path: ".planning/phases/27-price-feed-infrastructure/27-VERIFICATION.md"
      provides: "Verification report for Phase 27"
      contains: "PRICE-01, PRICE-02, PRICE-03, PRICE-04"
    - path: ".planning/phases/28-portfolio-backend-api/28-VERIFICATION.md"
      provides: "Verification report for Phase 28"
      contains: "PORT-04, PORT-05"
    - path: ".planning/phases/29-flutter-portfolio-ui/29-VERIFICATION.md"
      provides: "Verification report for Phase 29"
      contains: "DISP-01 through DISP-10"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Full traceability with all 20 checkboxes checked"
      contains: "[x]"
  key_links:
    - from: "VERIFICATION.md files"
      to: "SUMMARY.md files"
      via: "requirements-completed frontmatter cross-referenced by VERIFICATION requirements coverage section"
      pattern: "requirements-completed.*PORT|PRICE|DISP"
    - from: "REQUIREMENTS.md traceability"
      to: "VERIFICATION.md files"
      via: "Phase assignments in traceability table match VERIFICATION.md file locations"
      pattern: "\\[x\\].*Phase 2[6-9]|Phase 30"
---

<objective>
Create VERIFICATION.md for phases 26-29, add requirements-completed frontmatter to phases 27-28 SUMMARY files, and close all REQUIREMENTS.md traceability checkboxes.

Purpose: Formally verify all 20 v4.0 requirements are satisfied with evidence, completing the milestone verification gate.
Output: 4 new VERIFICATION.md files, 4 SUMMARY.md files updated with requirements-completed, REQUIREMENTS.md fully closed.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/30-critical-bug-fixes/30-VERIFICATION.md

# Phase 26 SUMMARYs (have requirements-completed already)
@.planning/phases/26-portfolio-domain-foundation/26-01-SUMMARY.md
@.planning/phases/26-portfolio-domain-foundation/26-02-SUMMARY.md
@.planning/phases/26-portfolio-domain-foundation/26-03-SUMMARY.md

# Phase 27 SUMMARYs (need requirements-completed added)
@.planning/phases/27-price-feed-infrastructure/27-01-SUMMARY.md
@.planning/phases/27-price-feed-infrastructure/27-02-SUMMARY.md

# Phase 28 SUMMARYs (need requirements-completed added)
@.planning/phases/28-portfolio-backend-api/28-01-SUMMARY.md
@.planning/phases/28-portfolio-backend-api/28-02-SUMMARY.md

# Phase 29 SUMMARYs (have requirements-completed already)
@.planning/phases/29-flutter-portfolio-ui/29-01-SUMMARY.md
@.planning/phases/29-flutter-portfolio-ui/29-02-SUMMARY.md
@.planning/phases/29-flutter-portfolio-ui/29-03-SUMMARY.md

# Phase 30 SUMMARY (has requirements-completed already)
@.planning/phases/30-critical-bug-fixes/30-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VERIFICATION.md for phases 26-29 and update SUMMARY frontmatter</name>
  <files>
    .planning/phases/26-portfolio-domain-foundation/26-VERIFICATION.md
    .planning/phases/27-price-feed-infrastructure/27-VERIFICATION.md
    .planning/phases/28-portfolio-backend-api/28-VERIFICATION.md
    .planning/phases/29-flutter-portfolio-ui/29-VERIFICATION.md
    .planning/phases/27-price-feed-infrastructure/27-01-SUMMARY.md
    .planning/phases/27-price-feed-infrastructure/27-02-SUMMARY.md
    .planning/phases/28-portfolio-backend-api/28-01-SUMMARY.md
    .planning/phases/28-portfolio-backend-api/28-02-SUMMARY.md
  </files>
  <action>
    Create 4 VERIFICATION.md files following the exact format of the existing `30-VERIFICATION.md` (YAML frontmatter with phase, verified, status, score, re_verification; then Observable Truths table, Required Artifacts table, Key Link Verification table, Requirements Coverage table, Anti-Patterns, Human Verification Required, Gaps Summary).

    For each VERIFICATION.md, read the actual source code files referenced in the SUMMARY.md files to gather real evidence (line numbers, function names, class names). Do NOT fabricate evidence. Each requirement must map to concrete code artifacts.

    **Phase 26 VERIFICATION.md** — Requirements: PORT-01, PORT-02, PORT-03, PORT-06
    - PORT-01: PortfolioAsset.Create() factory with name, ticker, AssetType, Currency params
    - PORT-02: AssetTransaction.Create() with date, quantity, pricePerUnit, currency; PortfolioAsset.AddTransaction()
    - PORT-03: FixedDeposit.Create() with principal, rate, startDate, maturityDate, compoundingFrequency
    - PORT-06: InterestCalculator.CalculateAccruedValue() with all 5 compounding modes + 8 unit tests

    **Phase 27 VERIFICATION.md** — Requirements: PRICE-01, PRICE-02, PRICE-03, PRICE-04
    - PRICE-01: CoinGeckoPriceProvider with 5-min freshness, Redis caching
    - PRICE-02: VNDirectPriceProvider with 48h TTL, stale-while-revalidate
    - PRICE-03: OpenErApiProvider with 12h TTL
    - PRICE-04: PriceFeedResult.IsStale + FetchedAt timestamp on all providers

    **Phase 28 VERIFICATION.md** — Requirements: PORT-04, PORT-05
    - PORT-04: PortfolioPurchaseCompletedEventHandler idempotent import via SourcePurchaseId
    - PORT-05: HistoricalPurchaseMigrator bulk migration triggered on first GET /summary

    **Phase 29 VERIFICATION.md** — Requirements: DISP-01 through DISP-10
    - DISP-01: CurrencyPreference provider with SharedPreferences persistence
    - DISP-02: AssetRow with value, P&L, percentage; AssetTypeSection grouping
    - DISP-03: AllocationDonutChart with PieChart sections
    - DISP-04: AddTransactionScreen Buy/Sell mode with form submission
    - DISP-05: AddTransactionScreen Fixed Deposit mode
    - DISP-06: TransactionHistoryScreen with filter bottom sheet
    - DISP-07: FixedDepositDetailScreen with accrued value, days to maturity, projected amount
    - DISP-08: Bot badge on auto-imported transactions (TransactionSource check)
    - DISP-09: StalenessLabel widget for cached VN prices
    - DISP-10: StalenessLabel for cross-currency conversion indicator

    Also update the 4 SUMMARY files that lack `requirements-completed` frontmatter:
    - `27-01-SUMMARY.md`: These are markdown-only (no YAML frontmatter). Add a line at the very end: `\n## Requirements Completed\n\nPRICE-01, PRICE-04\n` (CoinGecko provider + staleness tracking)
    - `27-02-SUMMARY.md`: Add `\n## Requirements Completed\n\nPRICE-02, PRICE-03, PRICE-04\n` (VNDirect, exchange rate, staleness)
    - `28-01-SUMMARY.md`: Add `\n## Requirements Completed\n\nPORT-04, PORT-05\n` (auto-import + historical migration)
    - `28-02-SUMMARY.md`: Add `\n## Requirements Completed\n\nPORT-04, PORT-05\n` (endpoints that surface the import)
  </action>
  <verify>
    All 4 VERIFICATION.md files exist and have valid YAML frontmatter with status: passed.
    All 11 SUMMARY.md files across phases 26-30 have requirements-completed data.
    Every requirement ID (PORT-01 through PORT-06, PRICE-01 through PRICE-04, DISP-01 through DISP-10) appears in at least one VERIFICATION.md.
  </verify>
  <done>
    4 VERIFICATION.md files created with per-requirement pass/fail status and real code evidence.
    4 SUMMARY.md files updated with requirements-completed.
    All 20 requirement IDs are covered across the verification documents.
  </done>
</task>

<task type="auto">
  <name>Task 2: Close REQUIREMENTS.md traceability — mark all 20 requirements as complete</name>
  <files>
    .planning/REQUIREMENTS.md
  </files>
  <action>
    Update `.planning/REQUIREMENTS.md`:

    1. In the "Portfolio Data Model" section, change all `[ ]` to `[x]` for PORT-01 through PORT-06. PORT-01 and PORT-03 are already `[x]`. Update the remaining:
       - PORT-02: `[x]` (Phase 26 — domain model + Phase 28 — API endpoint)
       - PORT-04: `[x]` (Phase 28 — auto-import handler)
       - PORT-05: `[x]` (Phase 28 — historical migration)
       - PORT-06: `[x]` (Phase 26 — InterestCalculator TDD)

    2. In the "Price Feeds" section, change all `[ ]` to `[x]`:
       - PRICE-01: `[x]` (Phase 27 — CoinGecko provider)
       - PRICE-02: `[x]` (Phase 27 — VNDirect provider)
       - PRICE-03: `[x]` (Phase 27 — OpenErApi provider)
       - PRICE-04: `[x]` (Phase 27 — PriceFeedResult.IsStale)

    3. In the "Portfolio Display" section, change all `[ ]` to `[x]`. DISP-03 and DISP-05 are already `[x]`. Update the remaining:
       - DISP-01: `[x]` (Phase 29 — CurrencyPreference)
       - DISP-02: `[x]` (Phase 29 — AssetRow/AssetTypeSection)
       - DISP-04: `[x]` (Phase 29 — AddTransactionScreen)
       - DISP-06: `[x]` (Phase 29 — TransactionHistoryScreen)
       - DISP-07: `[x]` (Phase 29 — FixedDepositDetailScreen)
       - DISP-08: `[x]` (Phase 29 — Bot badge)
       - DISP-09: `[x]` (Phase 29 — StalenessLabel)
       - DISP-10: `[x]` (Phase 29 — StalenessLabel cross-currency)

    4. Update the Traceability table at the bottom:
       - Change all `Pending` statuses to `Complete`
       - Ensure phase assignments are correct:
         - PORT-01: Phase 26, 30
         - PORT-02: Phase 26, 28
         - PORT-03: Phase 26, 30
         - PORT-04: Phase 28
         - PORT-05: Phase 28
         - PORT-06: Phase 26
         - PRICE-01: Phase 27
         - PRICE-02: Phase 27
         - PRICE-03: Phase 27
         - PRICE-04: Phase 27
         - DISP-01: Phase 29
         - DISP-02: Phase 29
         - DISP-03: Phase 29, 30
         - DISP-04: Phase 29
         - DISP-05: Phase 29, 30
         - DISP-06: Phase 29
         - DISP-07: Phase 29
         - DISP-08: Phase 29
         - DISP-09: Phase 29
         - DISP-10: Phase 29

    5. Update the last-updated date to 2026-02-21 and add note about milestone verification closure.
  </action>
  <verify>
    `grep -c '\[ \]' .planning/REQUIREMENTS.md` returns 0 for the v4.0 section (no unchecked requirements).
    `grep -c '\[x\]' .planning/REQUIREMENTS.md` returns 20 (all v4.0 requirements checked).
    All Traceability table rows show `Complete` status.
  </verify>
  <done>
    All 20 v4.0 requirements marked [x] in REQUIREMENTS.md with correct phase assignments and Complete status in traceability table.
    Zero unchecked requirements remain in the v4.0 section.
  </done>
</task>

</tasks>

<verification>
1. `ls .planning/phases/{26,27,28,29,30}-*/??-VERIFICATION.md` — all 5 exist
2. `grep -r 'requirements-completed\|Requirements Completed' .planning/phases/2[6-9]-*/*-SUMMARY.md .planning/phases/30-*/*-SUMMARY.md` — all 11 SUMMARY files have the field
3. `grep -c '\[ \]' .planning/REQUIREMENTS.md` in v4.0 section returns 0
4. `grep -c '\[x\]' .planning/REQUIREMENTS.md` returns at least 20
5. Each VERIFICATION.md has `status: passed` in frontmatter
</verification>

<success_criteria>
- 5 VERIFICATION.md files exist (phases 26-30), each with per-requirement pass/fail and real code evidence
- All 11 SUMMARY.md files have requirements-completed data
- REQUIREMENTS.md shows 20/20 requirements as [x] Complete
- Traceability is closed — every requirement ID traceable from REQUIREMENTS.md -> phase -> VERIFICATION.md -> SUMMARY.md
</success_criteria>

<output>
After completion, create `.planning/phases/31-milestone-verification/31-01-SUMMARY.md`
</output>
