---
phase: 35.2-dca-bot-detail-screen
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart
  - TradingBot.Mobile/lib/features/home/presentation/widgets/bot_identity_header.dart
  - TradingBot.Mobile/lib/features/home/presentation/widgets/bot_stats_grid.dart
  - TradingBot.Mobile/lib/features/home/presentation/widgets/bot_action_buttons.dart
  - TradingBot.Mobile/lib/app/router.dart
autonomous: true
requirements: [DCA-UI-01, DCA-UI-02, DCA-UI-03]

must_haves:
  truths:
    - "Tapping a navigation entry from HomeScreen pushes the DCA Bot Detail screen full-screen above the tab bar"
    - "Detail screen shows a 3-tab layout (Overview, History, Parameters) with smooth tab animation"
    - "Overview tab shows BTC icon, bot name, and uptime duration since first purchase"
    - "Overview tab shows a stats grid with invested amount, total PnL, frequency, amount per period, average price, and next purchase time"
    - "More and Share action buttons render with PressableScale micro-interaction"
    - "Back button returns to the previous screen"
    - "AmbientBackground orbs are visible behind the detail screen content"
  artifacts:
    - path: "TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart"
      provides: "DcaBotDetailScreen HookConsumerWidget with DefaultTabController 3-tab layout"
      contains: "HookConsumerWidget"
    - path: "TradingBot.Mobile/lib/features/home/presentation/widgets/bot_identity_header.dart"
      provides: "BTC icon + bot name + uptime header"
      contains: "BotIdentityHeader"
    - path: "TradingBot.Mobile/lib/features/home/presentation/widgets/bot_stats_grid.dart"
      provides: "6-field stat grid inside GlassCard"
      contains: "GlassCard"
    - path: "TradingBot.Mobile/lib/features/home/presentation/widgets/bot_action_buttons.dart"
      provides: "More + Share action buttons with PressableScale"
      contains: "PressableScale"
    - path: "TradingBot.Mobile/lib/app/router.dart"
      provides: "GoRoute for /home/bot-detail with rootNavigatorKey"
      contains: "bot-detail"
  key_links:
    - from: "TradingBot.Mobile/lib/app/router.dart"
      to: "dca_bot_detail_screen.dart"
      via: "GoRoute builder"
      pattern: "DcaBotDetailScreen"
    - from: "TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart"
      to: "homeDataProvider"
      via: "ref.watch for portfolio + status data"
      pattern: "ref\\.watch\\(homeDataProvider\\)"
    - from: "TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart"
      to: "configDataProvider"
      via: "ref.watch for config data"
      pattern: "ref\\.watch\\(configDataProvider\\)"
---

<objective>
Create the DCA Bot Detail screen structural shell with route, 3-tab layout, bot identity header, stats grid, and action buttons -- the Overview tab's upper content.

Purpose: Establishes the new detail screen as a navigable destination with the primary stats and identity sections visible. This is the structural prerequisite for the chart, bot info, event history, and remaining tab content in Plan 02.

Output: dca_bot_detail_screen.dart, bot_identity_header.dart, bot_stats_grid.dart, bot_action_buttons.dart, updated router.dart.
</objective>

<execution_context>
@/Users/baotoq/.claude/get-shit-done/workflows/execute-plan.md
@/Users/baotoq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35.2-dca-bot-detail-screen/35.2-RESEARCH.md
@.planning/phases/35.2-dca-bot-detail-screen/reference.png
@TradingBot.Mobile/lib/app/router.dart
@TradingBot.Mobile/lib/app/theme.dart
@TradingBot.Mobile/lib/features/home/data/home_providers.dart
@TradingBot.Mobile/lib/features/home/data/models/portfolio_response.dart
@TradingBot.Mobile/lib/features/home/data/models/status_response.dart
@TradingBot.Mobile/lib/features/config/data/config_providers.dart
@TradingBot.Mobile/lib/features/config/data/models/config_response.dart
@TradingBot.Mobile/lib/core/widgets/glass_card.dart
@TradingBot.Mobile/lib/core/widgets/pressable_scale.dart
@TradingBot.Mobile/lib/core/widgets/shimmer_loading.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bot identity header, stats grid, and action buttons widgets</name>
  <files>
    TradingBot.Mobile/lib/features/home/presentation/widgets/bot_identity_header.dart
    TradingBot.Mobile/lib/features/home/presentation/widgets/bot_stats_grid.dart
    TradingBot.Mobile/lib/features/home/presentation/widgets/bot_action_buttons.dart
  </files>
  <action>
Create three new widget files under `lib/features/home/presentation/widgets/`:

**bot_identity_header.dart** — `BotIdentityHeader` StatelessWidget:
- Takes `String? firstPurchaseDate` (ISO 8601 from PortfolioResponse).
- Layout: Padding(fromLTRB: 16, 16, 16, 8) wrapping a Row:
  1. CircleAvatar(radius: 24, backgroundColor: AppTheme.bitcoinOrange, child: Icon(Icons.currency_bitcoin, color: Colors.white, size: 28))
  2. SizedBox(width: 12)
  3. Column(crossAxisAlignment: start):
     - Text('BTC Recurring buy', fontWeight: bold, fontSize: 16, color: Colors.white)
     - Text(_formatUptime(firstPurchaseDate), fontSize: 13, color: Colors.white54)
- Private `_formatUptime(String? isoDate)` method:
  - If null: return 'Not started'
  - Parse DateTime, compute difference from DateTime.now()
  - Return 'Ongoing for ${days}D ${hours}h ${minutes}m' (days = duration.inDays, hours = duration.inHours % 24, minutes = duration.inMinutes % 60)

**bot_stats_grid.dart** — `BotStatsGrid` StatelessWidget:
- Takes required params: `PortfolioResponse portfolio`, `StatusResponse status`, `ConfigResponse config`.
- Wraps all content in `GlassCard` (default stationary variant) with margin: EdgeInsets.symmetric(horizontal: 16, vertical: 8), padding: EdgeInsets.all(16).
- Layout as Column:
  1. **Row 1** (two stat cells, Expanded each): "Invested amount (USDT)" = `_usdFormatter.format(portfolio.totalCost)` | "Total PnL (USDT)" = formatted PnL value in profitGreen/lossRed with percentage subtitle.
  2. SizedBox(height: 12) + Divider(color: Colors.white12) + SizedBox(height: 12)
  3. **Row 2** (three stat cells, Expanded each): "Frequency/Triggered" = `'Daily at ${_padTwo(config.dailyBuyHour)}:${_padTwo(config.dailyBuyMinute)} / ${portfolio.totalPurchaseCount}'` | "Amount per period (USDT)" = `config.baseDailyAmount.toStringAsFixed(0)` | "Average price (USDT)" = `'BTC ${_priceFormatter.format(portfolio.averageCostBasis ?? 0)}'`
  4. SizedBox(height: 12) + Divider(color: Colors.white12) + SizedBox(height: 12)
  5. **Next purchase row** (full width Row): Text('Next purchase at', color: Colors.white54, fontSize: 12), SizedBox(width: 8), Text(formatted nextBuyTime, using AppTheme.moneyStyle.copyWith(fontSize: 13))
- Private `_StatCell` widget: Column(crossAxisAlignment: start) with label Text (fontSize: 11, Colors.white54) + SizedBox(height: 4) + value Text (fontSize: 14, Colors.white, fontWeight w600) merged with AppTheme.moneyStyle. Optionally takes valueColor and subtitle/subtitleColor for PnL cell.
- Static formatters: `_usdFormatter = NumberFormat.currency(symbol: '', decimalDigits: 2)`, `_priceFormatter = NumberFormat.currency(symbol: '', decimalDigits: 1)`.
- For Total PnL: value = `'${pnl >= 0 ? '+' : ''}${_usdFormatter.format(pnl)}'` with color from `_pnlColor`. Subtitle = `'(${pnl >= 0 ? '+' : ''}${pnlPct.toStringAsFixed(2)}%)'` in same color. Handle null unrealizedPnl/unrealizedPnlPercent: show '--' in Colors.white54.
- `_pnlColor(double? pnl)`: if null -> Colors.white54, if > 0 -> AppTheme.profitGreen, if < 0 -> AppTheme.lossRed, else Colors.white54.
- `_padTwo(int n)`: `n.toString().padLeft(2, '0')`.
- Format nextBuyTime: if status.nextBuyTime is null, show '--'. Otherwise parse ISO and format with `DateFormat('MM/dd/yyyy, HH:mm').format(dt)` + ' (UTC+7)' (or use local timezone via `.toLocal()`).
- Use `Color.withAlpha(int)` NOT `withOpacity(float)`.

**bot_action_buttons.dart** — `BotActionButtons` StatelessWidget:
- Layout: Padding(symmetric horizontal: 16, vertical: 8) wrapping Row with two Expanded PressableScale buttons separated by SizedBox(width: 12).
- Each button: PressableScale wrapping Container with BoxDecoration (GlassTheme tintColor.withAlpha + borderColor border + BorderRadius.circular(12)). Padding symmetric horizontal: 16, vertical: 12. Row(mainAxisAlignment: center): Icon + SizedBox(width: 8) + Text.
- "More" button: Icon(Icons.apps, size: 18, Colors.white70), Text('More', fontSize: 14, Colors.white). onPressed: no-op with `// TODO: More actions TBD` comment.
- "Share" button: Icon(Icons.share_outlined, size: 18, Colors.white70), Text('Share', fontSize: 14, Colors.white). onPressed: copies portfolio summary to clipboard using `Clipboard.setData(ClipboardData(text: 'BTC DCA Bot - Invested: \$${portfolio.totalCost.toStringAsFixed(2)} | PnL: ${pnlPct?.toStringAsFixed(2) ?? '--'}%'))` + SnackBar 'Summary copied to clipboard'.
- Takes `PortfolioResponse portfolio` for share text and `BuildContext context` is available via build method.
- Read GlassTheme tokens: `final glass = Theme.of(context).extension<GlassTheme>()`.
  </action>
  <verify>
Run `dart analyze TradingBot.Mobile` — no errors in the three new widget files.
  </verify>
  <done>
Three widget files exist: BotIdentityHeader with BTC icon and uptime, BotStatsGrid with 6 stats in GlassCard, BotActionButtons with PressableScale More/Share. All use AppTheme.moneyStyle, withAlpha(int), correct color conventions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DcaBotDetailScreen and register route</name>
  <files>
    TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart
    TradingBot.Mobile/lib/app/router.dart
  </files>
  <action>
**dca_bot_detail_screen.dart** — `DcaBotDetailScreen` HookConsumerWidget:

Structure: DefaultTabController(length: 3) wrapping Scaffold.

**Scaffold:**
- No backgroundColor (global transparent from AppTheme.dark applies — AmbientBackground orbs visible).
- AppBar: title Text('Details'), backgroundColor Colors.transparent, elevation 0, surfaceTintColor Colors.transparent. Leading: BackButton (auto from GoRouter context). Actions: IconButton(Icons.share_outlined) with no-op for now.
- AppBar bottom: TabBar with 3 tabs: Tab(text: 'Overview'), Tab(text: 'History'), Tab(text: 'Parameters'). TabBar styling: indicatorColor: AppTheme.bitcoinOrange, labelColor: Colors.white, unselectedLabelColor: Colors.white54, dividerColor: Colors.transparent.

**Body:** TabBarView with 3 children:
1. Overview tab: `_OverviewTab` private widget
2. History tab: Center(child: Text('Purchase history', style: TextStyle(color: Colors.white54))) — placeholder for Plan 02
3. Parameters tab: Center(child: Text('Bot parameters', style: TextStyle(color: Colors.white54))) — placeholder for Plan 02

**_OverviewTab** — private HookConsumerWidget:
- `ref.watch(homeDataProvider)` for portfolio + status
- `ref.watch(configDataProvider)` for config
- Build method: Use nested switch on homeData and configData AsyncValues:
  - Both AsyncData: SingleChildScrollView with Column children:
    1. BotIdentityHeader(firstPurchaseDate: portfolio.firstPurchaseDate)
    2. BotStatsGrid(portfolio: portfolio, status: status, config: config)
    3. BotActionButtons(portfolio: portfolio)
    4. SizedBox(height: 16) + Padding(horizontal: 16, child: Text('Profit change', titleSmall style)) — placeholder header for chart (Plan 02)
    5. SizedBox(height: 200) — chart placeholder space
    6. SizedBox(height: 80) — bottom padding
  - Loading state: Center(CircularProgressIndicator()) — Plan 02 will add proper skeleton
  - Error state: Center(Text('Failed to load data'))
- Handle stale cache pattern: extract homeData.value before switch, show stale data + error snackbar on AsyncError when cached value exists.

**router.dart update:**
- Add import for DcaBotDetailScreen.
- Add a GoRoute under the `/home` branch (inside the existing GoRoute for '/home'):
```dart
GoRoute(
  path: 'bot-detail',
  parentNavigatorKey: rootNavigatorKey,
  builder: (_, __) => const DcaBotDetailScreen(),
),
```
- This makes the route `/home/bot-detail` and pushes full-screen above the navigation shell (no bottom nav bar visible on detail screen).

**Navigation trigger (temporary):** Add a GestureDetector or InkWell to HomeScreen's PortfolioStatsSection (or add a visible entry point). The simplest approach: In the detail screen itself, no trigger is needed since we can navigate via `context.push('/home/bot-detail')`. For testing, the route is directly accessible. A proper navigation entry point (e.g., tapping the portfolio section on HomeScreen) will be wired separately. For now, ensure the route works when pushed programmatically.
  </action>
  <verify>
Run `dart analyze TradingBot.Mobile` — no errors. Verify the route is registered by confirming the import and GoRoute in router.dart compile correctly.
  </verify>
  <done>
DcaBotDetailScreen exists as HookConsumerWidget with 3-tab layout (Overview/History/Parameters). Overview tab shows identity header, stats grid, and action buttons using real data from homeDataProvider + configDataProvider. Route registered at /home/bot-detail with parentNavigatorKey: rootNavigatorKey for full-screen push. Scaffold has transparent background so AmbientBackground shows through.
  </done>
</task>

</tasks>

<verification>
1. Run `dart analyze TradingBot.Mobile` — zero errors across all new/modified files
2. Visual check: Navigating to /home/bot-detail shows a full-screen detail page without bottom navigation bar
3. Visual check: "Details" title in AppBar with back button and share icon
4. Visual check: 3 tabs (Overview, History, Parameters) with orange indicator on active tab
5. Visual check: BTC orange CircleAvatar with bitcoin icon + "BTC Recurring buy" + uptime text
6. Visual check: Stats grid shows invested amount, PnL (colored), frequency, amount, avg price, next purchase time — all inside a GlassCard
7. Visual check: More and Share buttons have PressableScale press effect
8. Visual check: AmbientBackground navy orbs visible behind content
</verification>

<success_criteria>
- DcaBotDetailScreen is a HookConsumerWidget with DefaultTabController (3 tabs)
- Route registered at /home/bot-detail with parentNavigatorKey: rootNavigatorKey
- No Scaffold backgroundColor set (transparent via theme)
- BotIdentityHeader shows BTC icon, name, and computed uptime
- BotStatsGrid shows 6 stats in GlassCard (stationary) with correct data mapping
- BotActionButtons use PressableScale with GlassTheme tokens
- Total PnL colored with AppTheme.profitGreen/lossRed
- All monetary values use AppTheme.moneyStyle tabular figures
- All alpha values use withAlpha(int), not withOpacity(float)
- Frequency label shows "Daily at HH:MM / N" (not "Every 12 hours")
</success_criteria>

<output>
After completion, create `.planning/phases/35.2-dca-bot-detail-screen/35.2-01-SUMMARY.md`
</output>
