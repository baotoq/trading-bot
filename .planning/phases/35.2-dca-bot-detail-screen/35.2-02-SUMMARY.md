---
phase: 35.2-dca-bot-detail-screen
plan: 02
subsystem: ui
tags: [flutter, dart, fl_chart, riverpod, hooks_riverpod, glass_card, shimmer, pnl_chart, paginated_list]

# Dependency graph
requires:
  - phase: 35.2-01
    provides: DcaBotDetailScreen structural shell, 3-tab DefaultTabController, BotIdentityHeader, BotStatsGrid, BotActionButtons, /home/bot-detail route
  - phase: 34-pressable-scale
    provides: AppShimmer, Bone, skeletonizer integration
  - phase: 33-glass-foundation
    provides: GlassCard, GlassTheme, withAlpha convention
provides:
  - PnlChartCard: fl_chart LineChart with gradient area fill colored by PnL direction
  - BotInfoCard: Bot ID (derived from firstPurchaseDate ms) with clipboard copy + SnackBar
  - Overview tab complete: chart + bot info + 5-item event history preview
  - History tab (_HistoryTab): full paginated PurchaseListItem list with scroll-to-load-more
  - Parameters tab (_ParametersTab): 3 GlassCard sections (Schedule, Strategy, Tiers)
  - Loading skeleton: AppShimmer + Bone shapes matching Overview layout
affects: [future phase 35.3+]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - _PnlChartSection as isolated HookConsumerWidget for chartDataProvider subscription
    - _EventHistoryPreviewSection as isolated HookConsumerWidget for purchaseHistoryProvider
    - useScrollController hook with useEffect listener for scroll-to-load-more pagination
    - Switch expression on AsyncValue for all three tab loading/error/data states
    - Bone.text / Bone shapes inside GlassCard skeleton mimicking real layout

key-files:
  created:
    - TradingBot.Mobile/lib/features/home/presentation/widgets/pnl_chart_card.dart
    - TradingBot.Mobile/lib/features/home/presentation/widgets/bot_info_card.dart
  modified:
    - TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart

key-decisions:
  - "_PnlChartSection isolated as private HookConsumerWidget — keeps chartDataProvider subscription scoped to chart section only, avoids rebuilding BotInfoCard and history sections on chart state changes"
  - "_EventHistoryPreviewSection isolated as private HookConsumerWidget — purchaseHistoryProvider subscription scoped to preview section only"
  - "History tab uses useEffect + useScrollController hook — consistent with hooks_riverpod pattern; pagination triggers at maxScrollExtent - 200px threshold"
  - "BotInfoCard derives Bot ID as firstPurchaseDate.millisecondsSinceEpoch.toString() — stable unique ID without server-side bot ID endpoint"
  - "PnlChartCard uses withAlpha(77) not withOpacity(0.3) for gradient fill — consistent with project withAlpha convention"
  - "Removed unused purchase_history_response.dart import — PurchaseDto type inferred from provider, direct import not needed"

requirements-completed: [DCA-UI-04, DCA-UI-05, DCA-UI-06, DCA-UI-07]

# Metrics
duration: 3min
completed: 2026-02-22
---

# Phase 35.2 Plan 02: DCA Bot Detail Screen Content Summary

**Complete DCA Bot Detail screen with PnL area chart, Bot info card, event history preview, paginated History tab, read-only Parameters tab, and loading skeleton**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-22T13:57:55Z
- **Completed:** 2026-02-22T14:01:00Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments

- Created `PnlChartCard` using fl_chart `LineChart` — derives PnL% from `(price - avgCost) / avgCost * 100` for each price point, renders with green gradient fill (profit) or red gradient fill (loss), dashed zero line at y=0, no touch tooltip (keep it simple per plan spec)
- Created `BotInfoCard` with Bot ID derived from `firstPurchaseDate.millisecondsSinceEpoch`, clipboard copy via `Clipboard.setData` with `SnackBarBehavior.floating` confirmation, and creation time formatted as `MM/dd/yyyy, HH:mm:ss` in local timezone
- Completed Overview tab: identity header + stats grid + action buttons + `_PnlChartSection` (watches `chartDataProvider(timeframe: '1M')`) + `BotInfoCard` + `_EventHistoryPreviewSection` (last 5 purchases) + 80px bottom padding
- Implemented `_HistoryTab` with full paginated `ListView.builder` using `useScrollController()` hook and `useEffect` listener calling `loadNextPage()` at 200px from bottom; shows load-more spinner as last item when `hasMore`
- Implemented `_ParametersTab` with 3 `GlassCard(stationary)` sections — Schedule (daily buy time, base amount, dry run), Strategy (lookback days, bear MA period, boost factor, max cap), Multiplier Tiers (per-tier drop% and multiplier)
- Added `_buildLoadingSkeleton()` using `AppShimmer` with `Bone` shapes matching real layout: identity header row, stats grid 3-row pattern, action buttons row, chart area (200px Bone), bot info rows, 3 event history Container skeletons

## Task Commits

Each task was committed atomically:

1. **Task 1: Create PnL chart card and Bot info card widgets** - `bb1ca11` (feat)
2. **Task 2: Complete all 3 tabs and add loading skeleton** - `141a22e` (feat)

## Files Created/Modified

- `TradingBot.Mobile/lib/features/home/presentation/widgets/pnl_chart_card.dart` — `PnlChartCard` StatelessWidget with fl_chart `LineChart`, `_pnlColor` helper, `_buildPnlSpots` derivation from price + avgCost
- `TradingBot.Mobile/lib/features/home/presentation/widgets/bot_info_card.dart` — `BotInfoCard` StatelessWidget with `_InfoRow`, clipboard copy, `DateFormat('MM/dd/yyyy, HH:mm:ss')` formatting
- `TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart` — All 3 tabs complete + loading skeleton; `_PnlChartSection`, `_EventHistoryPreviewSection`, `_HistoryTab`, `_ParametersTab`, `_ParamRow` private widgets

## Decisions Made

- Isolated `_PnlChartSection` and `_EventHistoryPreviewSection` as private `HookConsumerWidget`s to scope provider subscriptions
- Used `useScrollController` + `useEffect` pattern for scroll pagination in `_HistoryTab`
- Bot ID derived from `firstPurchaseDate.millisecondsSinceEpoch.toString()` — stable, consistent with plan spec
- Removed unused `purchase_history_response.dart` import (Rule 1 auto-fix: unused import warning removed)

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Warning] Removed unused purchase_history_response.dart import**
- **Found during:** Task 2 analysis pass
- **Issue:** `dart analyze` reported unused import warning for `purchase_history_response.dart` — `PurchaseDto` type is inferred from `purchaseHistoryProvider`; explicit import not needed
- **Fix:** Removed the import line
- **Files modified:** `dca_bot_detail_screen.dart`
- **Commit:** `141a22e`

## Issues Encountered

None.

## User Setup Required

None — no external service configuration required.

## Next Phase Readiness

- DCA Bot Detail Screen is feature-complete: all 3 tabs fully implemented and navigable
- PnlChartCard can be enhanced with touch tooltips in a future phase
- History tab supports filters via `notifier.applyFilter()` — filter UI can be added later
- Parameters tab is read-only; edit functionality can be added in a future phase

## Self-Check: PASSED

- FOUND: `TradingBot.Mobile/lib/features/home/presentation/widgets/pnl_chart_card.dart`
- FOUND: `TradingBot.Mobile/lib/features/home/presentation/widgets/bot_info_card.dart`
- FOUND: `TradingBot.Mobile/lib/features/home/presentation/dca_bot_detail_screen.dart`
- FOUND: `.planning/phases/35.2-dca-bot-detail-screen/35.2-02-SUMMARY.md`
- FOUND: commit `bb1ca11` (feat: PnlChartCard and BotInfoCard)
- FOUND: commit `141a22e` (feat: complete all 3 tabs and loading skeleton)
- `dart analyze lib/` — No issues found

---
*Phase: 35.2-dca-bot-detail-screen*
*Completed: 2026-02-22*
