# Phase 09.1: Migrate Dashboard to Fresh Nuxt Setup - Research

**Researched:** 2026-02-13
**Domain:** Nuxt 3→4 migration, @nuxt/ui v3→v4 upgrade, .NET Aspire Node.js orchestration
**Confidence:** HIGH

## Summary

This phase involves migrating existing dashboard code from a Nuxt 3.15 setup (`dashboard/`) to a fresh Nuxt 4.3 installation (`TradingBot.Dashboard/`). The migration is more than a simple copy-paste due to significant architectural changes between Nuxt 3 and 4, particularly the new `app/` directory structure and the requirement to upgrade @nuxt/ui from v3 to v4.

The good news: Nuxt 4 maintains strong backward compatibility, and the migration path is well-documented. The server/ directory structure remains unchanged, meaning API proxy and authentication code can be migrated with minimal modifications. The main work involves adapting to the new directory structure, upgrading dependencies, and ensuring configuration files work with Nuxt 4's enhanced TypeScript project references system.

**Primary recommendation:** Follow Nuxt's official upgrade path by installing dependencies first, then migrating files while respecting the new `app/` directory structure. Server-side code (API routes, utils) can be copied directly. Update AppHost.cs to point to the new directory path as the final step.

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| nuxt | ^4.3.1 | Vue.js meta-framework | Latest stable, required for @nuxt/ui v4 |
| vue | ^3.5.28 | Progressive JavaScript framework | Nuxt 4 peer dependency |
| @nuxt/ui | ^4.0.0 | Component library with Tailwind v4 | Nuxt ecosystem official UI library, v4 required for Nuxt 4 |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| tailwindcss | ^4.0.0 | Utility-first CSS framework | Automatically included with @nuxt/ui v4 |
| typescript | ^5.6.0 | Type safety | Development only, Nuxt includes TS support |
| @nuxt/devtools | latest | Development tools | Opt-in development enhancement |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| @nuxt/ui v4 | PrimeVue, Vuetify | @nuxt/ui better integrated with Nuxt 4, includes Tailwind v4, less config |
| Tailwind v4 (via @nuxt/ui) | Manual Tailwind setup | @nuxt/ui bundles Tailwind v4 optimally, no need for @nuxtjs/tailwindcss module |

**Installation:**
```bash
cd TradingBot.Dashboard
npm install @nuxt/ui@^4.0.0 typescript@^5.6.0
npm install --save-dev @nuxt/devtools@latest
```

## Architecture Patterns

### Recommended Project Structure
```
TradingBot.Dashboard/
├── app/                    # NEW: All source code goes here (Nuxt 4 default)
│   ├── app.vue            # Main app component
│   ├── assets/
│   │   └── css/
│   │       └── main.css   # Tailwind/UI imports
│   ├── components/        # (future) Vue components
│   ├── composables/       # (future) Vue composables
│   └── pages/             # (future) File-based routes
├── server/                # Server-side code (stays at root)
│   ├── api/              # API routes (auto-prefixed with /api)
│   │   ├── health.get.ts
│   │   └── portfolio.get.ts
│   └── utils/            # Server utilities (importable via #server)
│       └── auth.ts
├── public/                # Static assets (stays at root)
├── .nuxt/                 # Generated files (gitignored)
├── node_modules/          # Dependencies (gitignored)
├── .gitignore
├── nuxt.config.ts         # Nuxt configuration
├── package.json
├── package-lock.json
└── tsconfig.json          # Root TS config (references .nuxt/tsconfig.*.json)
```

### Pattern 1: Server Directory Stays at Root
**What:** Unlike app code, `server/`, `public/`, and project config files remain at project root in Nuxt 4.
**When to use:** Always for server-side API routes, utilities, middleware, and public static assets.
**Example:**
```typescript
// server/api/portfolio.get.ts - stays at root, NOT in app/
export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig(event)
  // Server-to-server auth pattern
  const data = await $fetch(`${config.public.apiEndpoint}/api/dashboard/portfolio`, {
    headers: { 'x-api-key': config.apiKey }
  })
  return data
})
```

### Pattern 2: RuntimeConfig with NUXT_ Prefix
**What:** Environment variables must use `NUXT_` prefix (or `NUXT_PUBLIC_` for client-exposed values) to auto-override runtimeConfig values.
**When to use:** Always for production deployments where env vars are managed externally (like Aspire).
**Example:**
```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  runtimeConfig: {
    // Server-only (NUXT_API_KEY env var)
    apiKey: process.env.NUXT_API_KEY || '',
    // Client-exposed (NUXT_PUBLIC_API_ENDPOINT env var)
    public: {
      apiEndpoint: process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'
    }
  }
})
```

### Pattern 3: Tailwind v4 via CSS Imports
**What:** With @nuxt/ui v4, Tailwind CSS v4 is configured via CSS `@import` directives, NOT the @nuxtjs/tailwindcss module.
**When to use:** Always with @nuxt/ui v4. Do not install @nuxtjs/tailwindcss module - it will conflict.
**Example:**
```css
/* app/assets/css/main.css */
@import "tailwindcss";
@import "@nuxt/ui";
```
```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css']  // ~ resolves to app/ directory
})
```

### Pattern 4: TypeScript Project References
**What:** Nuxt 4 generates multiple context-specific tsconfig files (.nuxt/tsconfig.app.json, tsconfig.server.json, etc.) using TypeScript project references.
**When to use:** Default behavior, no action required. Root tsconfig.json should reference these files, not customize directly.
**Example:**
```json
// tsconfig.json (Nuxt 4 fresh init structure)
{
  "files": [],
  "references": [
    { "path": "./.nuxt/tsconfig.app.json" },
    { "path": "./.nuxt/tsconfig.server.json" },
    { "path": "./.nuxt/tsconfig.shared.json" },
    { "path": "./.nuxt/tsconfig.node.json" }
  ]
}
```

### Anti-Patterns to Avoid
- **Moving server/ into app/:** Server code stays at root. Only client-facing code moves to app/.
- **Using @nuxtjs/tailwindcss module with @nuxt/ui v4:** Creates conflicts. @nuxt/ui v4 bundles Tailwind v4, use CSS imports only.
- **Forgetting NUXT_ prefix:** Env vars without NUXT_ prefix won't override runtimeConfig in production.
- **Direct tsconfig.json modification:** Extend via nuxt.config.ts typescript options instead.
- **Mixing old and new directory structures:** Don't put some files in app/ and some at root (except server/public). Commit fully to new structure.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Proxy configuration | Custom proxy middleware | `routeRules` with `proxy` option | Built-in, works with Nitro server, handles headers/cookies/redirects |
| Server-side data fetching | Custom fetch wrapper | `$fetch` (Nuxt built-in) | Handles SSR context, auto-retry, type-safe |
| Environment config management | Custom .env loader | `runtimeConfig` with NUXT_ prefix | Auto-overrides at runtime, SSR-safe, type-safe |
| TypeScript config setup | Manual tsconfig per context | Let Nuxt generate .nuxt/tsconfig.*.json | Handles all contexts, project references, auto-updates |
| Component auto-imports | Manual import statements | Nuxt auto-imports from components/ | Zero config, tree-shakable, type-safe |

**Key insight:** Nuxt's conventions (auto-imports, routeRules, runtimeConfig) eliminate boilerplate and reduce configuration errors. Fighting the framework with custom solutions negates Nuxt's value proposition.

## Common Pitfalls

### Pitfall 1: Import Path Breakage After Directory Restructure
**What goes wrong:** After moving files to app/, imports using `~/` alias still work, but relative imports from server/ to app/ or vice versa fail.
**Why it happens:** `~` alias changes from root to app/ in Nuxt 4. Server code uses `#server` alias for internal imports.
**How to avoid:**
- In app code: Use `~/` for app-internal imports (e.g., `~/components/Button.vue`)
- In server code: Use `#server` for server-internal imports (e.g., `#server/utils/auth`)
- Don't import from app/ into server/ or vice versa. Use shared/ directory for truly shared code.
**Warning signs:** Build errors like "Cannot resolve module '~/server/utils/auth'" or "Cannot find module '../../../app/utils/helper'"

### Pitfall 2: Nuxt UI v3 Incompatibility with Nuxt 4
**What goes wrong:** Installing @nuxt/ui ^3.0.0 with Nuxt 4 causes build failures: "Cannot read properties of undefined (reading 'theme')", "Unknown word 'use strict'" from postcss-import.
**Why it happens:** @nuxt/ui v3 was designed for Nuxt 3. Nuxt 4 requires @nuxt/ui v4 due to Tailwind v4 integration changes and module API updates.
**How to avoid:** Always use @nuxt/ui v4 with Nuxt 4. Check package.json: if nuxt is ^4.x, @nuxt/ui must be ^4.x.
**Warning signs:** PostCSS errors during dev server start, missing Tailwind utilities, theme undefined errors.

### Pitfall 3: routeRules Proxy with Dynamic URLs
**What goes wrong:** routeRules proxy doesn't support runtime URL changes (e.g., switching API endpoints based on user action).
**Why it happens:** routeRules are evaluated at build time, not runtime. The proxy URL is fixed when the app builds.
**How to avoid:** Use routeRules proxy for static backend URLs (like our case - API endpoint is fixed per deployment). For dynamic proxying, create a custom Nitro API endpoint using `proxyRequest` helper.
**Warning signs:** Proxy works in dev but fails in production, or URL changes don't take effect without rebuild.

### Pitfall 4: Forgotten Environment Variable Prefix
**What goes wrong:** Setting `API_KEY=secret` env var doesn't override runtimeConfig.apiKey - still uses default value.
**Why it happens:** Nuxt only reads env vars with `NUXT_` prefix (or `NUXT_PUBLIC_` for client-exposed). Plain env vars are ignored.
**How to avoid:** Always use NUXT_ prefix: `NUXT_API_KEY=secret`, `NUXT_PUBLIC_API_ENDPOINT=http://backend`. Aspire's `WithEnvironment()` calls already use correct prefix.
**Warning signs:** Config values don't change between environments, "API key required" errors despite env var being set.

### Pitfall 5: TypeScript Strict Mode Breaking Existing Code
**What goes wrong:** Enabling `typescript: { strict: true }` in nuxt.config.ts causes hundreds of type errors in working code.
**Why it happens:** Strict mode enforces stricter null checks, implicit any detection, and stricter property initialization. Existing code may have been lax.
**How to avoid:**
- If migrating existing code, start with `strict: false`, then gradually fix types.
- For new code (like this migration), use `strict: true` from the start and write properly typed code.
- Use `typeCheck: false` to disable type-checking during dev (faster builds), but fix types before production.
**Warning signs:** Errors like "Object is possibly 'null'", "Parameter 'x' implicitly has an 'any' type", "Property 'y' has no initializer".

## Code Examples

Verified patterns from official sources:

### Migrating nuxt.config.ts (Nuxt 3 → 4)
```typescript
// Source: https://nuxt.com/docs/4.x/getting-started/upgrade
// Old (Nuxt 3): dashboard/nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css'],
  runtimeConfig: {
    apiKey: process.env.NUXT_API_KEY || '',
    public: {
      apiEndpoint: process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'
    }
  },
  routeRules: {
    '/proxy/api/**': {
      proxy: `${process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'}/api/**`
    }
  },
  devtools: { enabled: true },
  typescript: { strict: true, typeCheck: false },
  compatibilityDate: '2024-11-01'
})

// New (Nuxt 4): TradingBot.Dashboard/nuxt.config.ts
// Same config works! Just verify CSS path uses ~ (now resolves to app/)
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css'],  // ~ now points to app/, not root
  runtimeConfig: {
    apiKey: process.env.NUXT_API_KEY || '',
    public: {
      apiEndpoint: process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'
    }
  },
  routeRules: {
    '/proxy/api/**': {
      proxy: `${process.env.NUXT_PUBLIC_API_ENDPOINT || 'http://localhost:5000'}/api/**`
    }
  },
  devtools: { enabled: true },
  typescript: { strict: true, typeCheck: false },
  compatibilityDate: '2025-07-15'  // Update to Nuxt 4 date
})
```

### Server API Route with Auth (No Changes Needed)
```typescript
// Source: Existing code + https://nuxt.com/docs/4.x/directory-structure/server
// server/api/portfolio.get.ts - Works identically in Nuxt 3 and 4
export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig(event)

  try {
    const data = await $fetch(`${config.public.apiEndpoint}/api/dashboard/portfolio`, {
      headers: { 'x-api-key': config.apiKey }
    })
    return data
  } catch (error: any) {
    const statusCode = error?.response?.status || 502
    throw createError({
      status: statusCode,
      statusText: statusCode === 502 ? 'Bad Gateway' : error?.response?.statusText || 'Error',
      data: { reason: 'Failed to fetch portfolio from backend API' }
    })
  }
})
```

### Server Utility with Type Safety
```typescript
// Source: Existing code + https://nuxt.com/docs/4.x/directory-structure/server
// server/utils/auth.ts - Works identically in Nuxt 3 and 4
import type { H3Event } from 'h3'

export function requireApiKey(event: H3Event): void {
  const config = useRuntimeConfig(event)
  const authHeader = getHeader(event, 'x-api-key')

  if (!authHeader) {
    throw createError({
      status: 401,
      statusText: 'Unauthorized',
      data: { reason: 'API key required' }
    })
  }

  if (authHeader !== config.apiKey) {
    throw createError({
      status: 403,
      statusText: 'Forbidden',
      data: { reason: 'Invalid API key' }
    })
  }
}
```

### App Component with UApp Wrapper
```vue
<!-- Source: Existing code + https://ui.nuxt.com/docs/getting-started -->
<!-- app/app.vue (moved from root to app/ directory) -->
<template>
  <UApp>
    <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
      <div class="flex items-center justify-center min-h-screen">
        <div class="text-center">
          <h1 class="text-4xl font-bold text-gray-900 dark:text-white">
            BTC Smart DCA Dashboard
          </h1>
          <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
            Dashboard is running
          </p>
        </div>
      </div>
    </div>
  </UApp>
</template>
```

### Aspire AppHost Path Update
```csharp
// Source: https://aspire.dev/integrations/frameworks/javascript/
// TradingBot.AppHost/AppHost.cs - Only change: path from ../dashboard to ../TradingBot.Dashboard
var dashboard = builder.AddNodeApp("dashboard", "../TradingBot.Dashboard", "dev")
    .WithHttpEndpoint(port: 3000, env: "PORT")
    .WithExternalHttpEndpoints()
    .WithEnvironment("NUXT_PUBLIC_API_ENDPOINT", apiService.GetEndpoint("http"))
    .WithEnvironment("NUXT_API_KEY", dashboardApiKey)
    .WithReference(apiService)
    .WaitFor(apiService);
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Root-level app code | app/ directory structure | Nuxt 4.0 (Dec 2024) | All source code moves to app/, better separation from config |
| @nuxt/ui v3 | @nuxt/ui v4 | Dec 2024 | Requires Nuxt 4, bundles Tailwind v4, design system overhaul |
| @nuxtjs/tailwindcss module | CSS @import directives | @nuxt/ui v4 | No module needed, better performance, simpler config |
| Single tsconfig.json | Multiple tsconfig.*.json via project references | Nuxt 4.0 | Better type safety per context, faster IDE, clearer dependencies |
| Manual top-level generate config | nitro.prerender | Nuxt 3.x → 4.0 | Unified prerendering under Nitro, more flexible |
| AddNpmApp for Aspire | AddNodeApp for Nuxt | Aspire 9.0+ | Direct Node execution, bypasses npm script wrapper |

**Deprecated/outdated:**
- `generate` config: Use `nitro.prerender` instead
- `@nuxtjs/tailwindcss` with @nuxt/ui v4: Use CSS imports
- Top-level app.vue: Move to app/app.vue
- Root-level components/, pages/, etc.: Move to app/
- Old tsconfig structure: Let Nuxt generate via project references

## Open Questions

1. **Should we use compatibilityVersion option?**
   - What we know: Fresh Nuxt 4 init defaults to Nuxt 4 behavior, no compatibility flag needed.
   - What's unclear: If we encounter issues, could we temporarily set compatibilityVersion to ease migration?
   - Recommendation: Start without compatibility flags (full Nuxt 4). Only use if major blockers arise (unlikely for this simple migration).

2. **Should we migrate old dashboard/ or just copy files?**
   - What we know: Old dashboard/ has working Phase 9 code. New TradingBot.Dashboard/ is fresh nuxi init with correct structure.
   - What's unclear: Is there value in preserving git history from old directory?
   - Recommendation: Copy files to new directory (not git mv). Old directory will be deleted after migration succeeds. Git history is preserved in commit logs.

3. **What's the best order for testing after migration?**
   - What we know: Server routes, config, and app.vue are the critical pieces. Aspire integration is the final step.
   - What's unclear: Should we test standalone first (npm run dev) or via Aspire immediately?
   - Recommendation: Test standalone first (cd TradingBot.Dashboard && npm run dev), verify server routes work, then test via Aspire (cd TradingBot.AppHost && dotnet run). Faster iteration.

## Sources

### Primary (HIGH confidence)
- [Nuxt 4 Upgrade Guide](https://nuxt.com/docs/getting-started/upgrade) - Official migration path, breaking changes, compatibility
- [Nuxt 4 TypeScript Documentation](https://nuxt.com/docs/4.x/guide/concepts/typescript) - Project references, tsconfig structure
- [Nuxt 4 Server Directory](https://nuxt.com/docs/4.x/directory-structure/server) - Server structure, auto-imports, API routes
- [Nuxt 4 Runtime Config](https://nuxt.com/docs/4.x/guide/going-further/runtime-config) - NUXT_ prefix, runtimeConfig API
- [@nuxt/ui v4 Migration Guide](https://ui.nuxt.com/docs/getting-started/migration/v4) - Breaking changes, Tailwind v4 integration
- [Aspire JavaScript Integration](https://aspire.dev/integrations/frameworks/javascript/) - AddNodeApp, AddJavaScriptApp documentation

### Secondary (MEDIUM confidence)
- [Complete Guide: How to Upgrade to Nuxt 4](https://masteringnuxt.com/blog/complete-guide-how-to-upgrade-to-nuxt-4) - Practical migration steps
- [Nuxt UI v3 Announcement](https://nuxt.com/blog/nuxt-ui-v3) - @nuxt/ui v3 features, Tailwind v4 integration background
- [Installing Tailwind CSS v4 on Nuxt 3](https://masteringnuxt.com/blog/installing-tailwind-css-v4-on-nuxt-3) - Tailwind v4 setup patterns
- [How I Successfully Migrated to Nuxt 4 (Medium)](https://medium.com/simform-engineering/how-i-successfully-migrated-my-production-app-from-nuxt-3-to-nuxt-4-0b7379d0743d) - Real-world migration experience, pitfalls
- [Nuxt 4: A Practical Migration Guide (Medium)](https://medium.com/@ksenzhukd/nuxt-4-a-practical-migration-guide-from-nuxt-3-28c58cdae46d) - Step-by-step migration, common errors

### Tertiary (LOW confidence)
- GitHub discussions on proxy configuration, TypeScript strict mode - Community troubleshooting, not authoritative

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Verified via official docs, package versions confirmed in fresh init
- Architecture: HIGH - Official Nuxt 4 docs specify app/ structure, server/ stays at root
- Pitfalls: MEDIUM-HIGH - Validated via official docs + multiple real-world migration reports, but specific to project context

**Research date:** 2026-02-13
**Valid until:** 2026-03-15 (30 days - Nuxt ecosystem is stable, major changes unlikely)

**Notes:**
- Nuxt 3 maintenance ends Jan 2026 (already passed), Nuxt 4 is current stable
- @nuxt/ui v4 requires Nuxt 4, no backward compatibility with Nuxt 3
- Fresh nuxi init (TradingBot.Dashboard/) already uses correct Nuxt 4 structure
- Server code (server/api/, server/utils/) requires zero changes - works identically in Nuxt 3 and 4
- Main work is moving app.vue and assets/ to app/ directory, updating dependencies, and updating AppHost.cs path
